{"version":3,"file":"Block.js","sourceRoot":"","sources":["Block.ts"],"names":[],"mappings":";;;;;;;;;;;;IAAA,sDAAqD;IACrD,sCAAiC;IACjC,8CAAyC;IAGzC;QAA2B,iCAAW;QAIrC,eAAY,UAAgC;YAA5C,YACC,iBAAO,SAEP;YANO,gBAAU,GAAG,IAAI,iBAAO,EAAiB,CAAC;YAKjD,KAAI,CAAC,WAAW,GAAG,UAAU,CAAC,UAAU,CAAC;;QAC1C,CAAC;QAEM,mBAAG,GAAV,UAA+B,MAAS;YAAxC,iBAyBC;YAxBA,IAAM,eAAe,GAAQ;gBAAC,cAAc;qBAAd,UAAc,EAAd,qBAAc,EAAd,IAAc;oBAAd,yBAAc;;gBAC3C,IAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;gBACxC,IAAI,QAAQ,GAAG,KAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;gBAC3C,IAAI,QAAQ,EAAE;oBACb,IAAM,WAAW,GAAG,QAAQ,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;oBAC7C,IAAI,WAAW,KAAK,SAAS,EAAE;wBAC9B,OAAO,WAAW,CAAC;qBACnB;iBACD;gBACD,IAAM,MAAM,GAAG,MAAM,gCAAI,IAAI,EAAC,CAAC;gBAC/B,IAAI,MAAM,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,UAAU,EAAE;oBAChD,MAAM,CAAC,IAAI,CAAC,UAAC,MAAW;wBACvB,IAAI,CAAC,QAAQ,EAAE;4BACd,QAAQ,GAAG,IAAI,aAAG,EAAE,CAAC;4BACrB,KAAI,CAAC,UAAU,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAC;yBACtC;wBACD,QAAQ,CAAC,GAAG,CAAC,UAAU,EAAE,MAAM,CAAC,CAAC;wBACjC,KAAI,CAAC,WAAW,EAAE,CAAC;oBACpB,CAAC,CAAC,CAAC;oBACH,OAAO,IAAI,CAAC;iBACZ;gBACD,OAAO,MAAM,CAAC;YACf,CAAC,CAAC;YACF,OAAO,eAAoB,CAAC;QAC7B,CAAC;QACF,YAAC;IAAD,CAAC,AAnCD,CAA2B,yBAAW,GAmCrC;IAnCY,sBAAK;IAqClB,kBAAe,KAAK,CAAC","sourcesContent":["import { Destroyable } from '../../core/Destroyable';\nimport Map from '../../shim/Map';\nimport WeakMap from '../../shim/WeakMap';\nimport { WidgetMetaProperties, MetaBase } from '../interfaces';\n\nexport class Block extends Destroyable implements MetaBase {\n\tprivate _moduleMap = new WeakMap<Function, any>();\n\tprivate _invalidate: () => void;\n\n\tconstructor(properties: WidgetMetaProperties) {\n\t\tsuper();\n\t\tthis._invalidate = properties.invalidate;\n\t}\n\n\tpublic run<T extends Function>(module: T): T {\n\t\tconst decoratedModule: any = (...args: any[]) => {\n\t\t\tconst argsString = JSON.stringify(args);\n\t\t\tlet valueMap = this._moduleMap.get(module);\n\t\t\tif (valueMap) {\n\t\t\t\tconst cachedValue = valueMap.get(argsString);\n\t\t\t\tif (cachedValue !== undefined) {\n\t\t\t\t\treturn cachedValue;\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst result = module(...args);\n\t\t\tif (result && typeof result.then === 'function') {\n\t\t\t\tresult.then((result: any) => {\n\t\t\t\t\tif (!valueMap) {\n\t\t\t\t\t\tvalueMap = new Map();\n\t\t\t\t\t\tthis._moduleMap.set(module, valueMap);\n\t\t\t\t\t}\n\t\t\t\t\tvalueMap.set(argsString, result);\n\t\t\t\t\tthis._invalidate();\n\t\t\t\t});\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\treturn result;\n\t\t};\n\t\treturn decoratedModule as T;\n\t}\n}\n\nexport default Block;\n"]}