import { create, defer } from '../vdom';
import cache from './cache';
import icache from './icache';
const blockFactory = create({ defer, cache, icache });
export const block = blockFactory(({ middleware: { cache, icache, defer } }) => {
    let id = 1;
    return (module) => {
        return (...args) => {
            const argsString = JSON.stringify(args);
            const moduleId = cache.get(module) || id++;
            cache.set(module, moduleId);
            const cachedValue = icache.getOrSet(`${moduleId}-${argsString}`, async () => {
                const run = module(...args);
                defer.pause();
                const result = await run;
                defer.resume();
                return result;
            });
            return cachedValue || null;
        };
    };
});
export default block;
//# sourceMappingURL=block.mjs.map