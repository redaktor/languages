{"version":3,"file":"i18n.js","sourceRoot":"","sources":["i18n.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:interface-name */\nimport i18nCore, { Bundle, formatMessage, getCachedMessages, Messages } from '../../i18n/i18n';\nimport { create, invalidator, getRegistry } from '../vdom';\nimport injector from './injector';\nimport Map from '../../shim/Map';\nimport Injector from '../Injector';\nimport { I18nProperties, LocaleData, LocalizedMessages, INJECTOR_KEY, registerI18nInjector } from '../mixins/I18n';\n\nconst factory = create({ invalidator, injector, getRegistry }).properties<I18nProperties>();\n\nexport const i18n = factory(({ properties, middleware: { invalidator, injector, getRegistry } }) => {\n\tconst i18nInjector = injector.get(INJECTOR_KEY);\n\tif (!i18nInjector) {\n\t\tconst registry = getRegistry();\n\t\tif (registry) {\n\t\t\tregisterI18nInjector({}, registry.base);\n\t\t}\n\t}\n\tinjector.subscribe(INJECTOR_KEY);\n\n\tfunction getLocaleMessages(bundle: Bundle<Messages>): Messages | void {\n\t\tlet { locale } = properties();\n\t\tif (!locale) {\n\t\t\tconst injectedLocale = injector.get<Injector<LocaleData>>(INJECTOR_KEY);\n\t\t\tif (injectedLocale) {\n\t\t\t\tlocale = injectedLocale.get().locale;\n\t\t\t}\n\t\t}\n\t\tlocale = locale || i18nCore.locale;\n\t\tconst localeMessages = getCachedMessages(bundle, locale);\n\n\t\tif (localeMessages) {\n\t\t\treturn localeMessages;\n\t\t}\n\n\t\ti18nCore(bundle, locale).then(() => {\n\t\t\tinvalidator();\n\t\t});\n\t}\n\n\tfunction resolveBundle<T extends Messages>(bundle: Bundle<T>): Bundle<T> {\n\t\tlet { i18nBundle } = properties();\n\t\tif (i18nBundle) {\n\t\t\tif (i18nBundle instanceof Map) {\n\t\t\t\ti18nBundle = i18nBundle.get(bundle);\n\n\t\t\t\tif (!i18nBundle) {\n\t\t\t\t\treturn bundle;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn i18nBundle as Bundle<T>;\n\t\t}\n\t\treturn bundle;\n\t}\n\n\tfunction getBlankMessages<T extends Messages>(bundle: Bundle<T>): T {\n\t\tconst blank = {} as Messages;\n\t\treturn Object.keys(bundle.messages).reduce((blank, key) => {\n\t\t\tblank[key] = '';\n\t\t\treturn blank;\n\t\t}, blank) as T;\n\t}\n\n\treturn {\n\t\tlocalize<T extends Messages>(bundle: Bundle<T>, useDefaults = false): LocalizedMessages<T> {\n\t\t\tlet { locale } = properties();\n\t\t\tbundle = resolveBundle(bundle);\n\t\t\tconst messages = getLocaleMessages(bundle);\n\t\t\tconst isPlaceholder = !messages;\n\t\t\tif (!locale) {\n\t\t\t\tconst injectedLocale = injector.get<Injector<LocaleData>>(INJECTOR_KEY);\n\t\t\t\tif (injectedLocale) {\n\t\t\t\t\tlocale = injectedLocale.get().locale;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst format =\n\t\t\t\tisPlaceholder && !useDefaults\n\t\t\t\t\t? () => ''\n\t\t\t\t\t: (key: string, options?: any) => formatMessage(bundle, key, options, locale);\n\n\t\t\treturn Object.create({\n\t\t\t\tformat,\n\t\t\t\tisPlaceholder,\n\t\t\t\tmessages: messages || (useDefaults ? bundle.messages : getBlankMessages(bundle))\n\t\t\t});\n\t\t},\n\t\tset(localeData?: LocaleData) {\n\t\t\tconst currentLocale = injector.get<Injector<LocaleData | undefined>>(INJECTOR_KEY);\n\t\t\tif (currentLocale) {\n\t\t\t\tcurrentLocale.set(localeData);\n\t\t\t}\n\t\t},\n\t\tget() {\n\t\t\tconst currentLocale = injector.get<Injector<LocaleData | undefined>>(INJECTOR_KEY);\n\t\t\tif (currentLocale) {\n\t\t\t\treturn currentLocale.get();\n\t\t\t}\n\t\t}\n\t};\n});\n\nexport default i18n;\n"]}