{"version":3,"file":"i18n.mjs","sourceRoot":"","sources":["i18n.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:interface-name */\nimport i18nCore, { Bundle, formatMessage, getCachedMessages, Messages } from '../../i18n/i18n';\nimport { create, invalidator, getRegistry } from '../vdom';\nimport injector from './injector';\nimport Map from '../../shim/Map';\nimport Injector from '../Injector';\nimport { I18nProperties, LocaleData, LocalizedMessages, INJECTOR_KEY, registerI18nInjector } from '../mixins/I18n';\n\nconst factory = create({ invalidator, injector, getRegistry }).properties<I18nProperties>();\n\nexport const i18n = factory(({ properties, middleware: { invalidator, injector, getRegistry } }) => {\n\tconst i18nInjector = injector.get(INJECTOR_KEY);\n\tif (!i18nInjector) {\n\t\tconst registry = getRegistry();\n\t\tif (registry) {\n\t\t\tregisterI18nInjector({}, registry.base);\n\t\t}\n\t}\n\tinjector.subscribe(INJECTOR_KEY);\n\n\tfunction getLocaleMessages(bundle: Bundle<Messages>): Messages | void {\n\t\tlet { locale } = properties();\n\t\tif (!locale) {\n\t\t\tconst injectedLocale = injector.get<Injector<LocaleData>>(INJECTOR_KEY);\n\t\t\tif (injectedLocale) {\n\t\t\t\tlocale = injectedLocale.get().locale;\n\t\t\t}\n\t\t}\n\t\tlocale = locale || i18nCore.locale;\n\t\tconst localeMessages = getCachedMessages(bundle, locale);\n\n\t\tif (localeMessages) {\n\t\t\treturn localeMessages;\n\t\t}\n\n\t\ti18nCore(bundle, locale).then(() => {\n\t\t\tinvalidator();\n\t\t});\n\t}\n\n\tfunction resolveBundle<T extends Messages>(bundle: Bundle<T>): Bundle<T> {\n\t\tlet { i18nBundle } = properties();\n\t\tif (i18nBundle) {\n\t\t\tif (i18nBundle instanceof Map) {\n\t\t\t\ti18nBundle = i18nBundle.get(bundle);\n\n\t\t\t\tif (!i18nBundle) {\n\t\t\t\t\treturn bundle;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn i18nBundle as Bundle<T>;\n\t\t}\n\t\treturn bundle;\n\t}\n\n\tfunction getBlankMessages<T extends Messages>(bundle: Bundle<T>): T {\n\t\tconst blank = {} as Messages;\n\t\treturn Object.keys(bundle.messages).reduce((blank, key) => {\n\t\t\tblank[key] = '';\n\t\t\treturn blank;\n\t\t}, blank) as T;\n\t}\n\n\treturn {\n\t\tlocalize<T extends Messages>(bundle: Bundle<T>, useDefaults = false): LocalizedMessages<T> {\n\t\t\tlet { locale } = properties();\n\t\t\tbundle = resolveBundle(bundle);\n\t\t\tconst messages = getLocaleMessages(bundle);\n\t\t\tconst isPlaceholder = !messages;\n\t\t\tif (!locale) {\n\t\t\t\tconst injectedLocale = injector.get<Injector<LocaleData>>(INJECTOR_KEY);\n\t\t\t\tif (injectedLocale) {\n\t\t\t\t\tlocale = injectedLocale.get().locale;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst format =\n\t\t\t\tisPlaceholder && !useDefaults\n\t\t\t\t\t? () => ''\n\t\t\t\t\t: (key: string, options?: any) => formatMessage(bundle, key, options, locale);\n\n\t\t\treturn Object.create({\n\t\t\t\tformat,\n\t\t\t\tisPlaceholder,\n\t\t\t\tmessages: messages || (useDefaults ? bundle.messages : getBlankMessages(bundle))\n\t\t\t});\n\t\t},\n\t\tset(localeData?: LocaleData) {\n\t\t\tconst currentLocale = injector.get<Injector<LocaleData | undefined>>(INJECTOR_KEY);\n\t\t\tif (currentLocale) {\n\t\t\t\tcurrentLocale.set(localeData);\n\t\t\t}\n\t\t},\n\t\tget() {\n\t\t\tconst currentLocale = injector.get<Injector<LocaleData | undefined>>(INJECTOR_KEY);\n\t\t\tif (currentLocale) {\n\t\t\t\treturn currentLocale.get();\n\t\t\t}\n\t\t}\n\t};\n});\n\nexport default i18n;\n"]}