{"version":3,"file":"registerCustomElement.mjs","sourceRoot":"","sources":["registerCustomElement.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,QAAQ,MAAM,YAAY,CAAC;AAClC,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAC;AAC1C,OAAO,EAAE,QAAQ,EAAE,CAAC,EAAE,GAAG,EAAE,UAAU,EAAE,MAAM,QAAQ,CAAC;AACtD,OAAO,EAAE,IAAI,EAAE,MAAM,eAAe,CAAC;AACrC,OAAO,MAAM,MAAM,gBAAgB,CAAC;AACpC,OAAO,EAAE,qBAAqB,EAAE,MAAM,iBAAiB,CAAC;AACxD,OAAO,EAAE,YAAY,EAAE,MAAM,2BAA2B,CAAC;AAEzD,MAAM,cAAc,GAAG,CAAC,OAAO,CAAC,CAAC;AAEjC,MAAM,CAAN,IAAY,sBAIX;AAJD,WAAY,sBAAsB;IACjC,uCAAa,CAAA;IACb,uCAAa,CAAA;IACb,uCAAa,CAAA;AACd,CAAC,EAJW,sBAAsB,KAAtB,sBAAsB,QAIjC;AAED,SAAS,SAAS,CAAC,IAAS;IAC3B,OAAO,IAAI,IAAI,IAAI,CAAC,QAAQ,KAAK,CAAC,CAAC;AACpC,CAAC;AAED,SAAS,WAAW,CAAC,IAAS;IAC7B,OAAO,SAAS,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;AAC1D,CAAC;AAED,MAAM,UAAU,kBAAkB,CAAC,OAAoB;IAEtD,IAAM,kBAAkB,GAAxB,MAAM,kBAAmB,SAAQ,UAAe;QACrC,MAAM;YACf,MAAM,UAAU,GAAG,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,CACrD,CAAC,KAAK,EAAE,GAAW,EAAE,EAAE;gBACtB,MAAM,KAAK,GAAG,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;gBACnC,IAAI,GAAG,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;oBAClE,GAAG,GAAG,KAAK,GAAG,EAAE,CAAC;iBACjB;gBACD,KAAK,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;gBACnB,OAAO,KAAK,CAAC;YACd,CAAC,EACD,EAAS,CACT,CAAC;YACF,OAAO,GAAG,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC;QACnE,CAAC;QAED,MAAM,KAAK,OAAO;YACjB,OAAO,OAAO,CAAC;QAChB,CAAC;KACD,CAAA;IAnBK,kBAAkB;QADvB,YAAY,EAAE;OACT,kBAAkB,CAmBvB;IAED,OAAO,kBAAkB,CAAC;AAC3B,CAAC;AAED,MAAM,UAAU,MAAM,CAAC,UAAe,EAAE,iBAAsB;IAC7D,MAAM,EAAE,UAAU,GAAG,EAAE,EAAE,eAAe,GAAG,GAAG,EAAE,CAAC,IAAI,QAAQ,EAAE,EAAE,GAAG,UAAU,CAAC;IAC/E,MAAM,YAAY,GAAQ,EAAE,CAAC;IAE7B,UAAU,CAAC,OAAO,CAAC,CAAC,YAAoB,EAAE,EAAE;QAC3C,MAAM,aAAa,GAAG,YAAY,CAAC,WAAW,EAAE,CAAC;QACjD,YAAY,CAAC,aAAa,CAAC,GAAG,YAAY,CAAC;IAC5C,CAAC,CAAC,CAAC;IAEH,OAAO,KAAM,SAAQ,WAAW;QAAzB;;YAEE,gBAAW,GAAQ,EAAE,CAAC;YACtB,cAAS,GAAU,EAAE,CAAC;YACtB,qBAAgB,GAAQ,EAAE,CAAC;YAC3B,mBAAc,GAAQ,EAAE,CAAC;YACzB,iBAAY,GAAG,KAAK,CAAC;YACrB,eAAU,GAAG,UAAU,CAAC,SAAS,CAAC;QAgP3C,CAAC;QA9OO,iBAAiB;YACvB,IAAI,IAAI,CAAC,YAAY,EAAE;gBACtB,OAAO;aACP;YAED,IAAI,CAAC,cAAc,EAAE,CAAC;QACvB,CAAC;QAEO,cAAc;YACrB,IAAI,QAAQ,CAAC,UAAU,KAAK,SAAS,EAAE;gBACtC,OAAO,IAAI,CAAC;aACZ;YAED,IAAI,OAAO,GAAQ,IAAI,CAAC;YACxB,OAAO,OAAO,EAAE;gBACf,IAAI,OAAO,CAAC,WAAW,EAAE;oBACxB,OAAO,IAAI,CAAC;iBACZ;gBAED,OAAO,GAAG,OAAO,CAAC,UAAU,CAAC;aAC7B;YAED,OAAO,KAAK,CAAC;QACd,CAAC;QAEO,cAAc;YACrB,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;YACzB,IAAI,IAAI,CAAC,cAAc,EAAE,EAAE;gBAC1B,IAAI,CAAC,cAAc,EAAE,CAAC;aACtB;iBAAM;gBACN,UAAU,CAAC,GAAG,EAAE;oBACf,IAAI,CAAC,cAAc,EAAE,CAAC;gBACvB,CAAC,EAAE,GAAG,CAAC,CAAC;aACR;QACF,CAAC;QAEO,cAAc;YACrB,MAAM,aAAa,GAAQ,EAAE,CAAC;YAC9B,MAAM,EAAE,UAAU,GAAG,EAAE,EAAE,MAAM,GAAG,EAAE,EAAE,GAAG,UAAU,CAAC;YAEpD,IAAI,CAAC,WAAW,qBAAQ,IAAI,CAAC,WAAW,EAAK,IAAI,CAAC,uBAAuB,CAAC,UAAU,CAAC,CAAE,CAAC;YAExF,CAAC,GAAG,UAAU,EAAE,GAAG,UAAU,CAAC,CAAC,OAAO,CAAC,CAAC,YAAoB,EAAE,EAAE;gBAC/D,MAAM,cAAc,GAAG,cAAc,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC,CAAC;gBACnE,MAAM,KAAK,GACV,IAAI,CAAC,cAAc,CAAC,YAAY,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAE,IAAY,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC;gBAChG,IAAI,oBAAoB,GAAG,YAAY,CAAC,OAAO,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;gBAC7D,IAAI,cAAc,EAAE;oBACnB,oBAAoB,GAAG,KAAK,YAAY,EAAE,CAAC;iBAC3C;gBACD,IAAI,KAAK,KAAK,SAAS,EAAE;oBACxB,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC;iBACvC;gBAED,IAAI,oBAAoB,KAAK,YAAY,EAAE;oBAC1C,aAAa,CAAC,oBAAoB,CAAC,GAAG;wBACrC,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC;wBAC1C,GAAG,EAAE,CAAC,KAAU,EAAE,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,KAAK,CAAC;qBAC3D,CAAC;iBACF;gBAED,IAAI,CAAC,cAAc,EAAE;oBACpB,aAAa,CAAC,YAAY,CAAC,GAAG;wBAC7B,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC;wBAC1C,GAAG,EAAE,CAAC,KAAU,EAAE,EAAE,CAAC,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,KAAK,CAAC;qBAC3D,CAAC;iBACF;YACF,CAAC,CAAC,CAAC;YAEH,MAAM,CAAC,OAAO,CAAC,CAAC,YAAoB,EAAE,EAAE;gBACvC,MAAM,SAAS,GAAG,YAAY,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC;gBAChE,MAAM,oBAAoB,GAAG,YAAY,CAAC,OAAO,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC;gBAEjE,aAAa,CAAC,oBAAoB,CAAC,GAAG;oBACrC,GAAG,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC;oBAC/C,GAAG,EAAE,CAAC,KAAU,EAAE,EAAE,CAAC,IAAI,CAAC,iBAAiB,CAAC,YAAY,EAAE,KAAK,CAAC;iBAChE,CAAC;gBAEF,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,GAAG,SAAS,CAAC;gBAChD,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,GAAG,CAAC,GAAG,IAAW,EAAE,EAAE;oBACnD,MAAM,aAAa,GAAG,IAAI,CAAC,iBAAiB,CAAC,YAAY,CAAC,CAAC;oBAC3D,IAAI,OAAO,aAAa,KAAK,UAAU,EAAE;wBACxC,aAAa,CAAC,GAAG,IAAI,CAAC,CAAC;qBACvB;oBACD,IAAI,CAAC,aAAa,CACjB,IAAI,WAAW,CAAC,SAAS,EAAE;wBAC1B,OAAO,EAAE,KAAK;wBACd,MAAM,EAAE,IAAI;qBACZ,CAAC,CACF,CAAC;gBACH,CAAC,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,MAAM,CAAC,gBAAgB,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;YAE7C,MAAM,QAAQ,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,MAAM,CAC5C,CAAC,SAAS,EAAE,EAAE,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,CAAC,CACjF,CAAC;YAEF,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACrB,IAAI,QAAQ,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC,EAAE;oBACjD,IAAI,CAAC,UAAU,GAAG,sBAAsB,CAAC,IAAI,CAAC;iBAC9C;qBAAM;oBACN,IAAI,CAAC,UAAU,GAAG,sBAAsB,CAAC,IAAI,CAAC;iBAC9C;aACD;YAED,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,CAAC,SAAS,EAAE,EAAE;gBACpC,IAAI,IAAI,CAAC,UAAU,KAAK,sBAAsB,CAAC,IAAI,EAAE;oBACpD,SAAS,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;oBACnE,SAAS,CAAC,gBAAgB,CAAC,mBAAmB,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;oBACtE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,SAAwB,CAAC,CAAC,CAAC;iBAClE;qBAAM;oBACN,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,SAAwB,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;iBAC9E;YACF,CAAC,CAAC,CAAC;YAEH,IAAI,CAAC,gBAAgB,CAAC,mBAAmB,EAAE,CAAC,CAAM,EAAE,EAAE,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC,CAAC;YAEhF,MAAM,gBAAgB,GAAG,IAAI,CAAC,WAAW,CAAC;YAC1C,MAAM,cAAc,GAAG,GAAG,EAAE,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;YACjD,MAAM,OAAO,GAAG,KAAM,SAAQ,UAAU;gBACvC,MAAM;oBACL,OAAO,CAAC,CAAC,iBAAiB,EAAE,gBAAgB,EAAE,cAAc,EAAE,CAAC,CAAC;gBACjE,CAAC;aACD,CAAC;YACF,MAAM,QAAQ,GAAG,eAAe,EAAE,CAAC;YACnC,MAAM,YAAY,GAAG,qBAAqB,CAAC,IAAI,CAAC,SAAS,EAAE,EAAE,QAAQ,CAAC,CAAC;YACvE,MAAM,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,GAAG,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;YACpF,MAAM,CAAC,GAAG,QAAQ,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC,OAAO,EAAE,EAAE,CAAC,CAAC,CAAC;YACzC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC;YACnB,CAAC,CAAC,KAAK,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,CAAC,CAAC;YACnD,MAAM,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;YAC9B,IAAI,IAAI,EAAE;gBACT,MAAM,EAAE,OAAO,GAAG,OAAO,EAAE,GAAG,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;gBAC5D,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC;aAC7B;YAED,IAAI,CAAC,aAAa,CACjB,IAAI,WAAW,CAAC,mBAAmB,EAAE;gBACpC,OAAO,EAAE,IAAI;gBACb,MAAM,EAAE,IAAI;aACZ,CAAC,CACF,CAAC;QACH,CAAC;QAEO,SAAS;YAChB,IAAI,MAAM,IAAI,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC,KAAK,EAAE;gBACnD,OAAO,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;aACjD;QACF,CAAC;QAEO,eAAe,CAAC,CAAM;YAC7B,MAAM,IAAI,GAAG,CAAC,CAAC,MAAM,CAAC;YACtB,IAAI,IAAI,CAAC,UAAU,KAAK,IAAI,EAAE;gBAC7B,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,KAAK,IAAI,CAAC,CAAC;gBACtE,IAAI,CAAC,MAAM,EAAE;oBACZ,IAAI,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC;oBAC9D,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,CAAC,CAAC;oBAC9C,IAAI,CAAC,OAAO,EAAE,CAAC;iBACf;aACD;QACF,CAAC;QAEO,OAAO;YACd,IAAI,IAAI,CAAC,SAAS,EAAE;gBACnB,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,CAAC;gBAC5B,IAAI,CAAC,aAAa,CACjB,IAAI,WAAW,CAAC,gBAAgB,EAAE;oBACjC,OAAO,EAAE,KAAK;oBACd,MAAM,EAAE,IAAI;iBACZ,CAAC,CACF,CAAC;aACF;QACF,CAAC;QAEM,cAAc;YACpB,yBAAY,IAAI,CAAC,WAAW,EAAK,IAAI,CAAC,gBAAgB,EAAG;QAC1D,CAAC;QAEM,YAAY;YAClB,IAAI,IAAI,CAAC,UAAU,KAAK,sBAAsB,CAAC,IAAI,EAAE;gBACpD,OAAO,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,KAAU,EAAE,EAAE;oBAClF,MAAM,EAAE,OAAO,EAAE,GAAG,KAAK,CAAC;oBAC1B,OAAO,CAAC,CAAC,KAAK,oBAAO,OAAO,CAAC,cAAc,EAAE,GAAI,CAAC,GAAG,OAAO,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;gBAC/E,CAAC,CAAC,CAAC;aACH;iBAAM;gBACN,OAAO,IAAI,CAAC,SAAS,CAAC;aACtB;QACF,CAAC;QAEM,wBAAwB,CAAC,IAAY,EAAE,QAAuB,EAAE,KAAoB;YAC1F,MAAM,YAAY,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;YACxC,IAAI,CAAC,YAAY,CAAC,YAAY,EAAE,KAAK,CAAC,CAAC;QACxC,CAAC;QAEO,iBAAiB,CAAC,YAAoB,EAAE,KAAU;YACzD,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC;QAC7C,CAAC;QAEO,iBAAiB,CAAC,YAAoB;YAC7C,OAAO,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;QAC5C,CAAC;QAEO,YAAY,CAAC,YAAoB,EAAE,KAAU;YACpD,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC;YACvC,IAAI,CAAC,OAAO,EAAE,CAAC;QAChB,CAAC;QAEO,YAAY,CAAC,YAAoB;YACxC,OAAO,IAAI,CAAC,WAAW,CAAC,YAAY,CAAC,CAAC;QACvC,CAAC;QAEO,uBAAuB,CAAC,UAAoB;YACnD,OAAO,UAAU,CAAC,MAAM,CAAC,CAAC,UAAe,EAAE,YAAoB,EAAE,EAAE;gBAClE,MAAM,aAAa,GAAG,YAAY,CAAC,WAAW,EAAE,CAAC;gBACjD,MAAM,KAAK,GAAG,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,CAAC;gBAC/C,IAAI,KAAK,KAAK,IAAI,EAAE;oBACnB,UAAU,CAAC,YAAY,CAAC,GAAG,KAAK,CAAC;iBACjC;gBACD,OAAO,UAAU,CAAC;YACnB,CAAC,EAAE,EAAE,CAAC,CAAC;QACR,CAAC;QAED,MAAM,KAAK,kBAAkB;YAC5B,OAAO,MAAM,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAClC,CAAC;QAED,IAAW,QAAQ;YAClB,OAAO,IAAI,CAAC;QACb,CAAC;QAEM,GAAG,CAAC,GAAW,EAAE,KAAU;YACjC,IAAI,CAAC,cAAc,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;YACjC,IAAI,IAAI,CAAC,SAAS,EAAE;gBACnB,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;aAC9B;QACF,CAAC;KACD,CAAC;AACH,CAAC;AAED,MAAM,UAAU,QAAQ,CAAC,iBAAsB;IAC9C,MAAM,UAAU,GAAG,iBAAiB,CAAC,yBAAyB,CAAC;IAE/D,IAAI,CAAC,UAAU,EAAE;QAChB,MAAM,IAAI,KAAK,CACd,uGAAuG,CACvG,CAAC;KACF;IAED,MAAM,CAAC,cAAc,CAAC,MAAM,CAAC,UAAU,CAAC,OAAO,EAAE,MAAM,CAAC,UAAU,EAAE,iBAAiB,CAAC,CAAC,CAAC;AACzF,CAAC;AAED,eAAe,QAAQ,CAAC","sourcesContent":["import Registry from './Registry';\nimport { WidgetBase } from './WidgetBase';\nimport { renderer, w, dom, isTextNode } from './vdom';\nimport { from } from '../shim/array';\nimport global from '../shim/global';\nimport { registerThemeInjector } from './mixins/Themed';\nimport { alwaysRender } from './decorators/alwaysRender';\n\nconst RESERVED_PROPS = ['focus'];\n\nexport enum CustomElementChildType {\n\tDOJO = 'DOJO',\n\tNODE = 'NODE',\n\tTEXT = 'TEXT'\n}\n\nfunction isElement(item: any): item is Element {\n\treturn item && item.nodeType === 1;\n}\n\nfunction isDojoChild(item: any): boolean {\n\treturn isElement(item) && item.tagName.indexOf('-') > -1;\n}\n\nexport function DomToWidgetWrapper(domNode: HTMLElement): any {\n\t@alwaysRender()\n\tclass DomToWidgetWrapper extends WidgetBase<any> {\n\t\tprotected render() {\n\t\t\tconst properties = Object.keys(this.properties).reduce(\n\t\t\t\t(props, key: string) => {\n\t\t\t\t\tconst value = this.properties[key];\n\t\t\t\t\tif (key.indexOf('on') === 0 || RESERVED_PROPS.indexOf(key) !== -1) {\n\t\t\t\t\t\tkey = `__${key}`;\n\t\t\t\t\t}\n\t\t\t\t\tprops[key] = value;\n\t\t\t\t\treturn props;\n\t\t\t\t},\n\t\t\t\t{} as any\n\t\t\t);\n\t\t\treturn dom({ node: domNode, props: properties, diffType: 'dom' });\n\t\t}\n\n\t\tstatic get domNode() {\n\t\t\treturn domNode;\n\t\t}\n\t}\n\n\treturn DomToWidgetWrapper;\n}\n\nexport function create(descriptor: any, WidgetConstructor: any): any {\n\tconst { attributes = [], registryFactory = () => new Registry() } = descriptor;\n\tconst attributeMap: any = {};\n\n\tattributes.forEach((propertyName: string) => {\n\t\tconst attributeName = propertyName.toLowerCase();\n\t\tattributeMap[attributeName] = propertyName;\n\t});\n\n\treturn class extends HTMLElement {\n\t\tprivate _renderer: any;\n\t\tprivate _properties: any = {};\n\t\tprivate _children: any[] = [];\n\t\tprivate _eventProperties: any = {};\n\t\tprivate _propertiesMap: any = {};\n\t\tprivate _initialised = false;\n\t\tprivate _childType = descriptor.childType;\n\n\t\tpublic connectedCallback() {\n\t\t\tif (this._initialised) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._waitTillReady();\n\t\t}\n\n\t\tprivate _hasBeenParsed() {\n\t\t\tif (document.readyState !== 'loading') {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tlet element: any = this;\n\t\t\twhile (element) {\n\t\t\t\tif (element.nextSibling) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\telement = element.parentNode;\n\t\t\t}\n\n\t\t\treturn false;\n\t\t}\n\n\t\tprivate _waitTillReady() {\n\t\t\tthis._initialised = true;\n\t\t\tif (this._hasBeenParsed()) {\n\t\t\t\tthis._readyCallback();\n\t\t\t} else {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis._waitTillReady();\n\t\t\t\t}, 100);\n\t\t\t}\n\t\t}\n\n\t\tprivate _readyCallback() {\n\t\t\tconst domProperties: any = {};\n\t\t\tconst { properties = [], events = [] } = descriptor;\n\n\t\t\tthis._properties = { ...this._properties, ...this._attributesToProperties(attributes) };\n\n\t\t\t[...attributes, ...properties].forEach((propertyName: string) => {\n\t\t\t\tconst isReservedProp = RESERVED_PROPS.indexOf(propertyName) !== -1;\n\t\t\t\tconst value =\n\t\t\t\t\tthis._propertiesMap[propertyName] || !isReservedProp ? (this as any)[propertyName] : undefined;\n\t\t\t\tlet filteredPropertyName = propertyName.replace(/^on/, '__');\n\t\t\t\tif (isReservedProp) {\n\t\t\t\t\tfilteredPropertyName = `__${propertyName}`;\n\t\t\t\t}\n\t\t\t\tif (value !== undefined) {\n\t\t\t\t\tthis._properties[propertyName] = value;\n\t\t\t\t}\n\n\t\t\t\tif (filteredPropertyName !== propertyName) {\n\t\t\t\t\tdomProperties[filteredPropertyName] = {\n\t\t\t\t\t\tget: () => this._getProperty(propertyName),\n\t\t\t\t\t\tset: (value: any) => this._setProperty(propertyName, value)\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tif (!isReservedProp) {\n\t\t\t\t\tdomProperties[propertyName] = {\n\t\t\t\t\t\tget: () => this._getProperty(propertyName),\n\t\t\t\t\t\tset: (value: any) => this._setProperty(propertyName, value)\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tevents.forEach((propertyName: string) => {\n\t\t\t\tconst eventName = propertyName.replace(/^on/, '').toLowerCase();\n\t\t\t\tconst filteredPropertyName = propertyName.replace(/^on/, '__on');\n\n\t\t\t\tdomProperties[filteredPropertyName] = {\n\t\t\t\t\tget: () => this._getEventProperty(propertyName),\n\t\t\t\t\tset: (value: any) => this._setEventProperty(propertyName, value)\n\t\t\t\t};\n\n\t\t\t\tthis._eventProperties[propertyName] = undefined;\n\t\t\t\tthis._properties[propertyName] = (...args: any[]) => {\n\t\t\t\t\tconst eventCallback = this._getEventProperty(propertyName);\n\t\t\t\t\tif (typeof eventCallback === 'function') {\n\t\t\t\t\t\teventCallback(...args);\n\t\t\t\t\t}\n\t\t\t\t\tthis.dispatchEvent(\n\t\t\t\t\t\tnew CustomEvent(eventName, {\n\t\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\t\tdetail: args\n\t\t\t\t\t\t})\n\t\t\t\t\t);\n\t\t\t\t};\n\t\t\t});\n\n\t\t\tObject.defineProperties(this, domProperties);\n\n\t\t\tconst children = from(this.childNodes).filter(\n\t\t\t\t(childNode) => !isTextNode(childNode) || childNode.data.replace(/^\\s+|\\s+$/g, '')\n\t\t\t);\n\n\t\t\tif (!this._childType) {\n\t\t\t\tif (children.some((child) => isDojoChild(child))) {\n\t\t\t\t\tthis._childType = CustomElementChildType.DOJO;\n\t\t\t\t} else {\n\t\t\t\t\tthis._childType = CustomElementChildType.NODE;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfrom(children).forEach((childNode) => {\n\t\t\t\tif (this._childType === CustomElementChildType.DOJO) {\n\t\t\t\t\tchildNode.addEventListener('dojo-ce-render', () => this._render());\n\t\t\t\t\tchildNode.addEventListener('dojo-ce-connected', () => this._render());\n\t\t\t\t\tthis._children.push(DomToWidgetWrapper(childNode as HTMLElement));\n\t\t\t\t} else {\n\t\t\t\t\tthis._children.push(dom({ node: childNode as HTMLElement, diffType: 'dom' }));\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tthis.addEventListener('dojo-ce-connected', (e: any) => this._childConnected(e));\n\n\t\t\tconst widgetProperties = this._properties;\n\t\t\tconst renderChildren = () => this.__children__();\n\t\t\tconst Wrapper = class extends WidgetBase {\n\t\t\t\trender() {\n\t\t\t\t\treturn w(WidgetConstructor, widgetProperties, renderChildren());\n\t\t\t\t}\n\t\t\t};\n\t\t\tconst registry = registryFactory();\n\t\t\tconst themeContext = registerThemeInjector(this._getTheme(), registry);\n\t\t\tglobal.addEventListener('dojo-theme-set', () => themeContext.set(this._getTheme()));\n\t\t\tconst r = renderer(() => w(Wrapper, {}));\n\t\t\tthis._renderer = r;\n\t\t\tr.mount({ domNode: this, merge: false, registry });\n\t\t\tconst root = this.children[0];\n\t\t\tif (root) {\n\t\t\t\tconst { display = 'block' } = global.getComputedStyle(root);\n\t\t\t\tthis.style.display = display;\n\t\t\t}\n\n\t\t\tthis.dispatchEvent(\n\t\t\t\tnew CustomEvent('dojo-ce-connected', {\n\t\t\t\t\tbubbles: true,\n\t\t\t\t\tdetail: this\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tprivate _getTheme() {\n\t\t\tif (global && global.dojoce && global.dojoce.theme) {\n\t\t\t\treturn global.dojoce.themes[global.dojoce.theme];\n\t\t\t}\n\t\t}\n\n\t\tprivate _childConnected(e: any) {\n\t\t\tconst node = e.detail;\n\t\t\tif (node.parentNode === this) {\n\t\t\t\tconst exists = this._children.some((child) => child.domNode === node);\n\t\t\t\tif (!exists) {\n\t\t\t\t\tnode.addEventListener('dojo-ce-render', () => this._render());\n\t\t\t\t\tthis._children.push(DomToWidgetWrapper(node));\n\t\t\t\t\tthis._render();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate _render() {\n\t\t\tif (this._renderer) {\n\t\t\t\tthis._renderer.invalidate();\n\t\t\t\tthis.dispatchEvent(\n\t\t\t\t\tnew CustomEvent('dojo-ce-render', {\n\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\tdetail: this\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tpublic __properties__() {\n\t\t\treturn { ...this._properties, ...this._eventProperties };\n\t\t}\n\n\t\tpublic __children__() {\n\t\t\tif (this._childType === CustomElementChildType.DOJO) {\n\t\t\t\treturn this._children.filter((Child) => Child.domNode.isWidget).map((Child: any) => {\n\t\t\t\t\tconst { domNode } = Child;\n\t\t\t\t\treturn w(Child, { ...domNode.__properties__() }, [...domNode.__children__()]);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\treturn this._children;\n\t\t\t}\n\t\t}\n\n\t\tpublic attributeChangedCallback(name: string, oldValue: string | null, value: string | null) {\n\t\t\tconst propertyName = attributeMap[name];\n\t\t\tthis._setProperty(propertyName, value);\n\t\t}\n\n\t\tprivate _setEventProperty(propertyName: string, value: any) {\n\t\t\tthis._eventProperties[propertyName] = value;\n\t\t}\n\n\t\tprivate _getEventProperty(propertyName: string) {\n\t\t\treturn this._eventProperties[propertyName];\n\t\t}\n\n\t\tprivate _setProperty(propertyName: string, value: any) {\n\t\t\tthis._properties[propertyName] = value;\n\t\t\tthis._render();\n\t\t}\n\n\t\tprivate _getProperty(propertyName: string) {\n\t\t\treturn this._properties[propertyName];\n\t\t}\n\n\t\tprivate _attributesToProperties(attributes: string[]) {\n\t\t\treturn attributes.reduce((properties: any, propertyName: string) => {\n\t\t\t\tconst attributeName = propertyName.toLowerCase();\n\t\t\t\tconst value = this.getAttribute(attributeName);\n\t\t\t\tif (value !== null) {\n\t\t\t\t\tproperties[propertyName] = value;\n\t\t\t\t}\n\t\t\t\treturn properties;\n\t\t\t}, {});\n\t\t}\n\n\t\tstatic get observedAttributes() {\n\t\t\treturn Object.keys(attributeMap);\n\t\t}\n\n\t\tpublic get isWidget() {\n\t\t\treturn true;\n\t\t}\n\n\t\tpublic set(key: string, value: any) {\n\t\t\tthis._propertiesMap[key] = value;\n\t\t\tif (this._renderer) {\n\t\t\t\tthis._setProperty(key, value);\n\t\t\t}\n\t\t}\n\t};\n}\n\nexport function register(WidgetConstructor: any): void {\n\tconst descriptor = WidgetConstructor.__customElementDescriptor;\n\n\tif (!descriptor) {\n\t\tthrow new Error(\n\t\t\t'Cannot get descriptor for Custom Element, have you added the @customElement decorator to your Widget?'\n\t\t);\n\t}\n\n\tglobal.customElements.define(descriptor.tagName, create(descriptor, WidgetConstructor));\n}\n\nexport default register;\n"]}