{"version":3,"file":"vdom.js","sourceRoot":"","sources":["vdom.ts"],"names":[],"mappings":"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","sourcesContent":["import global from '../shim/global';\nimport has from '../core/has';\nimport WeakMap from '../shim/WeakMap';\nimport Set from '../shim/Set';\nimport Map from '../shim/Map';\nimport {\n\tWNode,\n\tVNode,\n\tDNode,\n\tVNodeProperties,\n\tTransitionStrategy,\n\tSupportedClassName,\n\tDomVNode,\n\tLazyDefine,\n\tConstructor,\n\tRenderResult,\n\tWidgetBaseInterface,\n\tCallback,\n\tMiddlewareMap,\n\tWNodeFactory,\n\tUnionToIntersection,\n\tWidgetProperties,\n\tMiddlewareResultFactory,\n\tWidgetBaseTypes,\n\tRegistryLabel,\n\tDeferredVirtualProperties,\n\tDomOptions\n} from './interfaces';\nimport { Registry, isWidget, isWidgetBaseConstructor, isWidgetFunction, isWNodeFactory } from './Registry';\nimport { auto } from './diff';\nimport RegistryHandler from './RegistryHandler';\nimport { NodeHandler } from './NodeHandler';\n\ndeclare global {\n\tnamespace JSX {\n\t\ttype Element = WNode;\n\t\tinterface ElementAttributesProperty {\n\t\t\tproperties: {};\n\t\t}\n\t\tinterface IntrinsicElements {\n\t\t\t[key: string]: VNodeProperties;\n\t\t}\n\t}\n}\n\nexport interface BaseNodeWrapper {\n\tid: string;\n\towningId: string;\n\tnode: WNode<any> | VNode;\n\tdomNode?: Node;\n\tdepth: number;\n\torder: number;\n\trequiresInsertBefore?: boolean;\n\thasPreviousSiblings?: boolean;\n\thasParentWNode?: boolean;\n\tnamespace?: string;\n\thasAnimations?: boolean;\n\tparentId: string;\n\tchildDomWrapperId?: string;\n}\n\nexport interface WNodeWrapper extends BaseNodeWrapper {\n\tnode: WNode<any>;\n\tinstance?: any;\n\tmergeNodes?: Node[];\n\tnodeHandlerCalled?: boolean;\n\tregistryItem?: Callback<any, any, RenderResult> | Constructor<any> | null;\n\tproperties: any;\n}\n\nexport interface WidgetMeta {\n\tmountNode: HTMLElement;\n\tdirty: boolean;\n\tinvalidator: () => void;\n\tmiddleware?: any;\n\tmiddlewareIds: string[];\n\tregistryHandler?: RegistryHandler;\n\tregistry: Registry;\n\tproperties: any;\n\tchildren?: DNode[];\n\trendering: boolean;\n\tnodeMap?: Map<string | number, HTMLElement>;\n\tdestroyMap?: Map<string, () => void>;\n\tdeferRefs: number;\n\tcustomDiffProperties?: Set<string>;\n\tcustomDiffMap?: Map<string, Map<string, (current: any, next: any) => void>>;\n}\n\nexport interface WidgetData {\n\tonDetach: () => void;\n\tonAttach: () => void;\n\tdirty: boolean;\n\tnodeHandler: NodeHandler;\n\tinvalidate?: Function;\n\trendering: boolean;\n\tinputProperties: any;\n\tregistry: RegistryHandler;\n}\n\nexport interface VNodeWrapper extends BaseNodeWrapper {\n\tnode: VNode | DomVNode;\n\tmerged?: boolean;\n\tinserted?: boolean;\n\tdeferredProperties?: VNodeProperties;\n}\n\nexport type DNodeWrapper = VNodeWrapper | WNodeWrapper;\n\nexport interface MountOptions {\n\tsync: boolean;\n\tmerge: boolean;\n\ttransition?: TransitionStrategy;\n\tdomNode: HTMLElement;\n\tregistry: Registry;\n}\n\nexport interface Renderer {\n\tinvalidate(): void;\n\tmount(mountOptions?: Partial<MountOptions>): void;\n}\n\ninterface ProcessItem {\n\tcurrent?: (WNodeWrapper | VNodeWrapper)[];\n\tnext?: (WNodeWrapper | VNodeWrapper)[];\n\tmeta: ProcessMeta;\n}\n\ninterface ProcessResult {\n\titem?: ProcessItem;\n\twidget?: AttachApplication | DetachApplication;\n\tdom?: ApplicationInstruction;\n}\n\ninterface ProcessMeta {\n\tmergeNodes?: Node[];\n\toldIndex?: number;\n\tnewIndex?: number;\n}\n\ninterface InvalidationQueueItem {\n\tid: string;\n\tdepth: number;\n\torder: number;\n}\n\ninterface Instruction {\n\tcurrent: undefined | DNodeWrapper;\n\tnext: undefined | DNodeWrapper;\n}\n\ninterface CreateWidgetInstruction {\n\tnext: WNodeWrapper;\n}\n\ninterface UpdateWidgetInstruction {\n\tcurrent: WNodeWrapper;\n\tnext: WNodeWrapper;\n}\n\ninterface RemoveWidgetInstruction {\n\tcurrent: WNodeWrapper;\n}\n\ninterface CreateDomInstruction {\n\tnext: VNodeWrapper;\n}\n\ninterface UpdateDomInstruction {\n\tcurrent: VNodeWrapper;\n\tnext: VNodeWrapper;\n}\n\ninterface RemoveDomInstruction {\n\tcurrent: VNodeWrapper;\n}\n\ninterface AttachApplication {\n\ttype: 'attach';\n\tid: string;\n\tinstance?: WidgetBaseInterface;\n\tattached?: boolean;\n}\n\ninterface DetachApplication {\n\ttype: 'detach';\n\tcurrent: WNodeWrapper;\n\tinstance?: WidgetBaseInterface;\n}\n\ninterface CreateDomApplication {\n\ttype: 'create';\n\tcurrent?: VNodeWrapper;\n\tnext: VNodeWrapper;\n\tparentDomNode: Node;\n}\n\ninterface DeleteDomApplication {\n\ttype: 'delete';\n\tcurrent: VNodeWrapper;\n}\n\ninterface UpdateDomApplication {\n\ttype: 'update';\n\tcurrent: VNodeWrapper;\n\tnext: VNodeWrapper;\n}\n\ninterface PreviousProperties {\n\tproperties: any;\n\tattributes?: any;\n\tevents?: any;\n}\n\ntype ApplicationInstruction =\n\t| CreateDomApplication\n\t| UpdateDomApplication\n\t| DeleteDomApplication\n\t| Required<AttachApplication>\n\t| DetachApplication;\n\nconst EMPTY_ARRAY: DNodeWrapper[] = [];\nconst nodeOperations = ['focus', 'blur', 'scrollIntoView', 'click'];\nconst NAMESPACE_W3 = 'http://www.w3.org/';\nconst NAMESPACE_SVG = NAMESPACE_W3 + '2000/svg';\nconst NAMESPACE_XLINK = NAMESPACE_W3 + '1999/xlink';\nconst WNODE = '__WNODE_TYPE';\nconst VNODE = '__VNODE_TYPE';\nconst DOMVNODE = '__DOMVNODE_TYPE';\n\nexport function isTextNode(item: any): item is Text {\n\treturn item && item.nodeType === 3;\n}\n\nfunction isLazyDefine(item: any): item is LazyDefine<any> {\n\treturn Boolean(item && item.label);\n}\n\nfunction isWNodeWrapper(child: DNodeWrapper): child is WNodeWrapper {\n\treturn child && isWNode(child.node);\n}\n\nfunction isVNodeWrapper(child?: DNodeWrapper | null): child is VNodeWrapper {\n\treturn !!child && isVNode(child.node);\n}\n\nfunction isVirtualWrapper(child?: DNodeWrapper | null): boolean {\n\treturn isVNodeWrapper(child) && child.node.tag === 'virtual';\n}\n\nfunction isBodyWrapper(wrapper?: DNodeWrapper): boolean {\n\treturn isVNodeWrapper(wrapper) && wrapper.node.tag === 'body';\n}\n\nfunction isAttachApplication(value: any): value is AttachApplication | DetachApplication {\n\treturn !!value.type;\n}\n\nexport function isWNode<W extends WidgetBaseTypes = any>(child: any): child is WNode<W> {\n\treturn Boolean(child && child !== true && typeof child !== 'string' && child.type === WNODE);\n}\n\nexport function isVNode(child: DNode): child is VNode {\n\treturn Boolean(\n\t\tchild && child !== true && typeof child !== 'string' && (child.type === VNODE || child.type === DOMVNODE)\n\t);\n}\n\nexport function isDomVNode(child: DNode): child is DomVNode {\n\treturn Boolean(child && child !== true && typeof child !== 'string' && child.type === DOMVNODE);\n}\n\nexport function isElementNode(value: any): value is Element {\n\treturn !!value.tagName;\n}\n\nfunction toTextVNode(data: any): VNode {\n\treturn {\n\t\ttag: '',\n\t\tproperties: {},\n\t\tchildren: undefined,\n\t\ttext: `${data}`,\n\t\ttype: VNODE\n\t};\n}\n\nfunction updateAttributes(\n\tdomNode: Element,\n\tpreviousAttributes: { [index: string]: string | undefined },\n\tattributes: { [index: string]: string | undefined },\n\tnamespace?: string\n) {\n\tconst attrNames = Object.keys(attributes);\n\tconst attrCount = attrNames.length;\n\tfor (let i = 0; i < attrCount; i++) {\n\t\tconst attrName = attrNames[i];\n\t\tconst attrValue = attributes[attrName];\n\t\tconst previousAttrValue = previousAttributes[attrName];\n\t\tif (attrValue !== previousAttrValue) {\n\t\t\tupdateAttribute(domNode, attrName, attrValue, namespace);\n\t\t}\n\t}\n}\n\n/**\n * Wrapper function for calls to create a widget.\n */\nexport function w<W extends WidgetBaseTypes>(\n\tnode: WNode<W>,\n\tproperties: Partial<W['properties']>,\n\tchildren?: W['children']\n): WNode<W>;\nexport function w<W extends WidgetBaseTypes>(\n\twidgetConstructor: Constructor<W> | RegistryLabel | WNodeFactory<W> | LazyDefine<W>,\n\tproperties: W['properties'],\n\tchildren?: W['children']\n): WNode<W>;\nexport function w<W extends WidgetBaseTypes>(\n\twidgetConstructorOrNode:\n\t\t| Constructor<W>\n\t\t| RegistryLabel\n\t\t| WNodeFactory<W>\n\t\t| WNode<W>\n\t\t| LazyDefine<W>\n\t\t| Callback<any, any, RenderResult>,\n\tproperties: W['properties'],\n\tchildren?: W['children']\n): WNode<W> {\n\tif (isWNodeFactory<W>(widgetConstructorOrNode)) {\n\t\treturn widgetConstructorOrNode(properties, children);\n\t}\n\n\tif (isWNode<W>(widgetConstructorOrNode)) {\n\t\tproperties = { ...(widgetConstructorOrNode.properties as any), ...(properties as any) };\n\t\tchildren = children ? children : widgetConstructorOrNode.children;\n\t\twidgetConstructorOrNode = widgetConstructorOrNode.widgetConstructor;\n\t}\n\n\treturn {\n\t\tchildren: children || [],\n\t\twidgetConstructor: widgetConstructorOrNode,\n\t\tproperties,\n\t\ttype: WNODE\n\t};\n}\n\n/**\n * Wrapper function for calls to create VNodes.\n */\nexport function v(node: VNode, properties: VNodeProperties, children: undefined | DNode[]): VNode;\nexport function v(node: VNode, properties: VNodeProperties): VNode;\nexport function v(tag: string, children: undefined | DNode[]): VNode;\nexport function v<K extends keyof HTMLElementTagNameMap>(\n\ttag: K,\n\tproperties: DeferredVirtualProperties | VNodeProperties<HTMLElementTagNameMap[K]>,\n\tchildren?: DNode[]\n): VNode;\nexport function v(tag: string, properties: DeferredVirtualProperties | VNodeProperties, children?: DNode[]): VNode;\nexport function v(tag: string): VNode;\nexport function v(\n\ttag: string | VNode,\n\tpropertiesOrChildren: VNodeProperties | DeferredVirtualProperties | DNode[] = {},\n\tchildren: undefined | DNode[] = undefined\n): VNode {\n\tlet properties: VNodeProperties | DeferredVirtualProperties = propertiesOrChildren;\n\tlet deferredPropertiesCallback;\n\n\tif (Array.isArray(propertiesOrChildren)) {\n\t\tchildren = propertiesOrChildren;\n\t\tproperties = {};\n\t}\n\n\tif (typeof properties === 'function') {\n\t\tdeferredPropertiesCallback = properties;\n\t\tproperties = {};\n\t}\n\n\tif (isVNode(tag)) {\n\t\tlet { classes = [], styles = {}, ...newProperties } = properties;\n\t\tlet { classes: nodeClasses = [], styles: nodeStyles = {}, ...nodeProperties } = tag.properties;\n\t\tnodeClasses = Array.isArray(nodeClasses) ? nodeClasses : [nodeClasses];\n\t\tclasses = Array.isArray(classes) ? classes : [classes];\n\t\tstyles = { ...nodeStyles, ...styles };\n\t\tproperties = { ...nodeProperties, ...newProperties, classes: [...nodeClasses, ...classes], styles };\n\t\tchildren = children ? children : tag.children;\n\t\ttag = tag.tag;\n\t}\n\n\treturn {\n\t\ttag,\n\t\tdeferredPropertiesCallback,\n\t\tchildren,\n\t\tproperties,\n\t\ttype: VNODE\n\t};\n}\n\n/**\n * Create a VNode for an existing DOM Node.\n */\nexport function dom(\n\t{ node, attrs = {}, props = {}, on = {}, diffType = 'none', onAttach }: DomOptions,\n\tchildren?: DNode[]\n): DomVNode {\n\treturn {\n\t\ttag: isElementNode(node) ? node.tagName.toLowerCase() : '',\n\t\tproperties: props,\n\t\tattributes: attrs,\n\t\tevents: on,\n\t\tchildren,\n\t\ttype: DOMVNODE,\n\t\tdomNode: node,\n\t\ttext: isElementNode(node) ? undefined : node.data,\n\t\tdiffType,\n\t\tonAttach\n\t};\n}\n\nexport const REGISTRY_ITEM = '__registry_item';\n\nexport class FromRegistry<P> {\n\tstatic type = REGISTRY_ITEM;\n\tproperties: P = {} as P;\n\tname: string | undefined;\n}\n\nexport function fromRegistry<P>(tag: string): Constructor<FromRegistry<P>> {\n\treturn class extends FromRegistry<P> {\n\t\tproperties: P = {} as P;\n\t\tstatic type = REGISTRY_ITEM;\n\t\tname = tag;\n\t};\n}\n\nfunction spreadChildren(children: any[], child: any): any[] {\n\tif (Array.isArray(child)) {\n\t\treturn child.reduce(spreadChildren, children);\n\t} else {\n\t\treturn [...children, child];\n\t}\n}\n\nexport function tsx(tag: any, properties = {}, ...children: any[]): DNode {\n\tchildren = children.reduce(spreadChildren, []);\n\tproperties = properties === null ? {} : properties;\n\tif (typeof tag === 'string') {\n\t\treturn v(tag, properties, children);\n\t} else if (tag.type === 'registry' && (properties as any).__autoRegistryItem) {\n\t\tconst name = (properties as any).__autoRegistryItem;\n\t\tdelete (properties as any).__autoRegistryItem;\n\t\treturn w(name, properties, children);\n\t} else if (tag.type === REGISTRY_ITEM) {\n\t\tconst registryItem = new tag();\n\t\treturn w(registryItem.name, properties, children);\n\t} else {\n\t\treturn w(tag, properties, children);\n\t}\n}\n\nexport function propertiesDiff(current: any, next: any, invalidator: () => void, ignoreProperties: string[]) {\n\tconst propertyNames = [...Object.keys(current), ...Object.keys(next)];\n\tfor (let i = 0; i < propertyNames.length; i++) {\n\t\tif (ignoreProperties.indexOf(propertyNames[i]) > -1) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst result = auto(current[propertyNames[i]], next[propertyNames[i]]);\n\t\tif (result.changed) {\n\t\t\tinvalidator();\n\t\t\tbreak;\n\t\t}\n\t\tignoreProperties.push(propertyNames[i]);\n\t}\n}\n\nfunction buildPreviousProperties(domNode: any, current: VNodeWrapper) {\n\tconst {\n\t\tnode: { diffType, properties, attributes }\n\t} = current;\n\tif (!diffType || diffType === 'vdom') {\n\t\treturn {\n\t\t\tproperties: current.deferredProperties\n\t\t\t\t? { ...current.deferredProperties, ...current.node.properties }\n\t\t\t\t: current.node.properties,\n\t\t\tattributes: current.node.attributes,\n\t\t\tevents: current.node.events\n\t\t};\n\t} else if (diffType === 'none') {\n\t\treturn {\n\t\t\tproperties: {},\n\t\t\tattributes: current.node.attributes ? {} : undefined,\n\t\t\tevents: current.node.events\n\t\t};\n\t}\n\tlet newProperties: any = {\n\t\tproperties: {}\n\t};\n\tif (attributes) {\n\t\tnewProperties.attributes = {};\n\t\tnewProperties.events = current.node.events;\n\t\tObject.keys(properties).forEach((propName) => {\n\t\t\tnewProperties.properties[propName] = domNode[propName];\n\t\t});\n\t\tObject.keys(attributes).forEach((attrName) => {\n\t\t\tnewProperties.attributes[attrName] = domNode.getAttribute(attrName);\n\t\t});\n\t\treturn newProperties;\n\t}\n\tnewProperties.properties = Object.keys(properties).reduce(\n\t\t(props, property) => {\n\t\t\tprops[property] = domNode.getAttribute(property) || domNode[property];\n\t\t\treturn props;\n\t\t},\n\t\t{} as any\n\t);\n\treturn newProperties;\n}\n\nfunction checkDistinguishable(wrappers: DNodeWrapper[], index: number, parentWNodeWrapper?: WNodeWrapper) {\n\tconst wrapperToCheck = wrappers[index];\n\tif (isVNodeWrapper(wrapperToCheck) && !wrapperToCheck.node.tag) {\n\t\treturn;\n\t}\n\tconst { key } = wrapperToCheck.node.properties;\n\tlet parentName = 'unknown';\n\tif (parentWNodeWrapper) {\n\t\tconst {\n\t\t\tnode: { widgetConstructor }\n\t\t} = parentWNodeWrapper;\n\t\tparentName = (widgetConstructor as any).name || 'unknown';\n\t}\n\n\tif (key === undefined || key === null) {\n\t\tfor (let i = 0; i < wrappers.length; i++) {\n\t\t\tif (i !== index) {\n\t\t\t\tconst wrapper = wrappers[i];\n\t\t\t\tif (same(wrapper, wrapperToCheck)) {\n\t\t\t\t\tlet nodeIdentifier: string;\n\t\t\t\t\tif (isWNodeWrapper(wrapper)) {\n\t\t\t\t\t\tnodeIdentifier = (wrapper.node.widgetConstructor as any).name || 'unknown';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnodeIdentifier = wrapper.node.tag;\n\t\t\t\t\t}\n\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t`A widget (${parentName}) has had a child added or removed, but they were not able to uniquely identified. It is recommended to provide a unique 'key' property when using the same widget or element (${nodeIdentifier}) multiple times as siblings`\n\t\t\t\t\t);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction same(dnode1: DNodeWrapper, dnode2: DNodeWrapper): boolean {\n\tif (isVNodeWrapper(dnode1) && isVNodeWrapper(dnode2)) {\n\t\tif (isDomVNode(dnode1.node) && isDomVNode(dnode2.node)) {\n\t\t\tif (dnode1.node.domNode !== dnode2.node.domNode) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\tif (dnode1.node.tag !== dnode2.node.tag) {\n\t\t\treturn false;\n\t\t}\n\t\tif (dnode1.node.properties.key !== dnode2.node.properties.key) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t} else if (isWNodeWrapper(dnode1) && isWNodeWrapper(dnode2)) {\n\t\tconst widgetConstructor1 = dnode1.registryItem || dnode1.node.widgetConstructor;\n\t\tconst widgetConstructor2 = dnode2.registryItem || dnode2.node.widgetConstructor;\n\t\tif (dnode1.instance === undefined && typeof widgetConstructor2 === 'string') {\n\t\t\treturn false;\n\t\t}\n\t\tif (widgetConstructor1 !== widgetConstructor2) {\n\t\t\treturn false;\n\t\t}\n\t\tif (dnode1.node.properties.key !== dnode2.node.properties.key) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nfunction findIndexOfChild(children: DNodeWrapper[], sameAs: DNodeWrapper, start: number) {\n\tfor (let i = start; i < children.length; i++) {\n\t\tif (same(children[i], sameAs)) {\n\t\t\treturn i;\n\t\t}\n\t}\n\treturn -1;\n}\n\nfunction createClassPropValue(classes: SupportedClassName | SupportedClassName[] = []) {\n\tlet classNames = '';\n\tif (Array.isArray(classes)) {\n\t\tfor (let i = 0; i < classes.length; i++) {\n\t\t\tlet className = classes[i];\n\t\t\tif (className && className !== true) {\n\t\t\t\tclassNames = classNames ? `${classNames} ${className}` : className;\n\t\t\t}\n\t\t}\n\t\treturn classNames;\n\t}\n\tif (classes && classes !== true) {\n\t\tclassNames = classes;\n\t}\n\treturn classNames;\n}\n\nfunction updateAttribute(domNode: Element, attrName: string, attrValue: string | undefined, namespace?: string) {\n\tif (namespace === NAMESPACE_SVG && attrName === 'href' && attrValue) {\n\t\tdomNode.setAttributeNS(NAMESPACE_XLINK, attrName, attrValue);\n\t} else if ((attrName === 'role' && attrValue === '') || attrValue === undefined) {\n\t\tdomNode.removeAttribute(attrName);\n\t} else {\n\t\tdomNode.setAttribute(attrName, attrValue);\n\t}\n}\n\nfunction arrayFrom(arr: any) {\n\treturn Array.prototype.slice.call(arr);\n}\n\nfunction createFactory(callback: any, middlewares: any): any {\n\tconst factory = (properties: any, children?: any) => {\n\t\tif (properties) {\n\t\t\tconst result = w(callback, properties, children);\n\t\t\tcallback.isWidget = true;\n\t\t\tcallback.middlewares = middlewares;\n\t\t\treturn result;\n\t\t}\n\t\treturn {\n\t\t\tmiddlewares,\n\t\t\tcallback\n\t\t};\n\t};\n\tfactory.isFactory = true;\n\treturn factory;\n}\n\nexport function create<T extends MiddlewareMap, MiddlewareProps = ReturnType<T[keyof T]>['properties']>(\n\tmiddlewares: T = {} as T\n) {\n\tfunction properties<Props extends {}>() {\n\t\tfunction returns<ReturnValue>(\n\t\t\tcallback: Callback<WidgetProperties & Props & UnionToIntersection<MiddlewareProps>, T, ReturnValue>\n\t\t): ReturnValue extends RenderResult\n\t\t\t? WNodeFactory<{\n\t\t\t\t\tproperties: Props & WidgetProperties & UnionToIntersection<MiddlewareProps>;\n\t\t\t\t\tchildren: DNode[];\n\t\t\t  }>\n\t\t\t: MiddlewareResultFactory<WidgetProperties & Props & UnionToIntersection<MiddlewareProps>, T, ReturnValue> {\n\t\t\treturn createFactory(callback, middlewares);\n\t\t}\n\t\treturn returns;\n\t}\n\n\tfunction returns<ReturnValue>(\n\t\tcallback: Callback<WidgetProperties & UnionToIntersection<MiddlewareProps>, T, ReturnValue>\n\t): ReturnValue extends RenderResult\n\t\t? WNodeFactory<{\n\t\t\t\tproperties: WidgetProperties & UnionToIntersection<MiddlewareProps>;\n\t\t\t\tchildren: DNode[];\n\t\t  }>\n\t\t: MiddlewareResultFactory<WidgetProperties & UnionToIntersection<MiddlewareProps>, T, ReturnValue> {\n\t\treturn createFactory(callback, middlewares);\n\t}\n\treturns.properties = properties;\n\treturn returns;\n}\n\nconst factory = create();\n\nfunction wrapNodes(renderer: () => RenderResult) {\n\tconst result = renderer();\n\tconst isWNodeWrapper = isWNode(result);\n\tconst callback = () => {\n\t\treturn result;\n\t};\n\tcallback.isWNodeWrapper = isWNodeWrapper;\n\treturn factory(callback);\n}\n\nexport const widgetInstanceMap = new WeakMap<WidgetBaseInterface, WidgetData>();\nconst widgetMetaMap = new Map<string, WidgetMeta>();\nconst requestedDomNodes = new Set();\nlet wrapperId = 0;\nlet metaId = 0;\n\nfunction addNodeToMap(id: string, key: string | number, node: HTMLElement) {\n\tconst widgetMeta = widgetMetaMap.get(id);\n\tif (widgetMeta) {\n\t\twidgetMeta.nodeMap = widgetMeta.nodeMap || new Map();\n\t\twidgetMeta.nodeMap.set(key, node);\n\t\tif (requestedDomNodes.has(`${id}-${key}`)) {\n\t\t\twidgetMeta.invalidator();\n\t\t\trequestedDomNodes.delete(`${id}-${key}`);\n\t\t}\n\t}\n}\n\nfunction destroyHandles(meta: WidgetMeta) {\n\tconst { destroyMap, middlewareIds } = meta;\n\tif (!destroyMap) {\n\t\treturn;\n\t}\n\tfor (let i = 0; i < middlewareIds.length; i++) {\n\t\tconst id = middlewareIds[i];\n\t\tconst destroy = destroyMap.get(id);\n\t\tdestroy && destroy();\n\t\tdestroyMap.delete(id);\n\t\tif (destroyMap.size === 0) {\n\t\t\tbreak;\n\t\t}\n\t}\n\tdestroyMap.clear();\n}\n\nfunction runDiffs(meta: WidgetMeta, current: any, next: any) {\n\tmeta.customDiffMap = meta.customDiffMap || new Map();\n\tif (meta.customDiffMap.size) {\n\t\tmeta.customDiffMap.forEach((diffMap) => {\n\t\t\tdiffMap.forEach((diff) => diff({ ...current }, { ...next }));\n\t\t});\n\t}\n}\n\nexport const invalidator = factory(({ id }) => {\n\tconst [widgetId] = id.split('-');\n\treturn () => {\n\t\tconst widgetMeta = widgetMetaMap.get(widgetId);\n\t\tif (widgetMeta) {\n\t\t\treturn widgetMeta.invalidator();\n\t\t}\n\t};\n});\n\nexport const node = factory(({ id }) => {\n\treturn {\n\t\tget(key: string | number): HTMLElement | null {\n\t\t\tconst [widgetId] = id.split('-');\n\t\t\tconst widgetMeta = widgetMetaMap.get(widgetId);\n\t\t\tif (widgetMeta) {\n\t\t\t\twidgetMeta.nodeMap = widgetMeta.nodeMap || new Map();\n\t\t\t\tconst mountNode = widgetMeta.mountNode;\n\t\t\t\tconst node = widgetMeta.nodeMap.get(key);\n\t\t\t\tif (node && mountNode.contains(node)) {\n\t\t\t\t\treturn node;\n\t\t\t\t}\n\t\t\t\trequestedDomNodes.add(`${widgetId}-${key}`);\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t};\n});\n\nexport const diffProperty = factory(({ id }) => {\n\treturn (propertyName: string, diff: (current: any, next: any) => void) => {\n\t\tconst [widgetId] = id.split('-');\n\t\tconst widgetMeta = widgetMetaMap.get(widgetId);\n\t\tif (widgetMeta) {\n\t\t\twidgetMeta.customDiffMap = widgetMeta.customDiffMap || new Map();\n\t\t\twidgetMeta.customDiffProperties = widgetMeta.customDiffProperties || new Set();\n\t\t\tconst propertyDiffMap = widgetMeta.customDiffMap.get(id) || new Map();\n\t\t\tif (!propertyDiffMap.has(propertyName)) {\n\t\t\t\tpropertyDiffMap.set(propertyName, diff);\n\t\t\t\twidgetMeta.customDiffProperties.add(propertyName);\n\t\t\t}\n\t\t\twidgetMeta.customDiffMap.set(id, propertyDiffMap);\n\t\t}\n\t};\n});\n\nexport const destroy = factory(({ id }) => {\n\treturn (destroyFunction: () => void): void => {\n\t\tconst [widgetId] = id.split('-');\n\t\tconst widgetMeta = widgetMetaMap.get(widgetId);\n\t\tif (widgetMeta) {\n\t\t\twidgetMeta.destroyMap = widgetMeta.destroyMap || new Map();\n\t\t\tif (!widgetMeta.destroyMap.has(id)) {\n\t\t\t\twidgetMeta.destroyMap.set(id, destroyFunction);\n\t\t\t}\n\t\t}\n\t};\n});\n\nexport const getRegistry = factory(({ id }) => {\n\tconst [widgetId] = id.split('-');\n\treturn (): RegistryHandler | null => {\n\t\tconst widgetMeta = widgetMetaMap.get(widgetId);\n\t\tif (widgetMeta) {\n\t\t\tif (!widgetMeta.registryHandler) {\n\t\t\t\twidgetMeta.registryHandler = new RegistryHandler();\n\t\t\t\twidgetMeta.registryHandler.base = widgetMeta.registry;\n\t\t\t\twidgetMeta.registryHandler.on('invalidate', widgetMeta.invalidator);\n\t\t\t}\n\t\t\twidgetMeta.registryHandler = widgetMeta.registryHandler || new RegistryHandler();\n\t\t\treturn widgetMeta.registryHandler;\n\t\t}\n\t\treturn null;\n\t};\n});\n\nexport const defer = factory(({ id }) => {\n\tconst [widgetId] = id.split('-');\n\tlet isDeferred = false;\n\treturn {\n\t\tpause() {\n\t\t\tconst widgetMeta = widgetMetaMap.get(widgetId);\n\t\t\tif (!isDeferred && widgetMeta) {\n\t\t\t\twidgetMeta.deferRefs = widgetMeta.deferRefs + 1;\n\t\t\t\tisDeferred = true;\n\t\t\t}\n\t\t},\n\t\tresume() {\n\t\t\tconst widgetMeta = widgetMetaMap.get(widgetId);\n\t\t\tif (isDeferred && widgetMeta) {\n\t\t\t\twidgetMeta.deferRefs = widgetMeta.deferRefs - 1;\n\t\t\t\tisDeferred = false;\n\t\t\t}\n\t\t}\n\t};\n});\n\nexport function renderer(renderer: () => RenderResult): Renderer {\n\tlet _mountOptions: MountOptions = {\n\t\tsync: false,\n\t\tmerge: true,\n\t\ttransition: undefined,\n\t\tdomNode: global.document.body,\n\t\tregistry: new Registry()\n\t};\n\tlet _invalidationQueue: InvalidationQueueItem[] = [];\n\tlet _processQueue: (ProcessItem | DetachApplication | AttachApplication)[] = [];\n\tlet _deferredProcessQueue: (ProcessItem | DetachApplication | AttachApplication)[] = [];\n\tlet _applicationQueue: ApplicationInstruction[] = [];\n\tlet _eventMap = new WeakMap<Function, EventListener>();\n\tlet _idToWrapperMap = new Map<string, DNodeWrapper>();\n\tlet _wrapperSiblingMap = new WeakMap<DNodeWrapper, DNodeWrapper>();\n\tlet _idToChildrenWrappers = new Map<string, DNodeWrapper[]>();\n\tlet _insertBeforeMap: undefined | WeakMap<DNodeWrapper, Node> = new WeakMap<DNodeWrapper, Node>();\n\tlet _nodeToWrapperMap = new WeakMap<VNode | WNode<any>, WNodeWrapper>();\n\tlet _renderScheduled: number | undefined;\n\tlet _idleCallbacks: Function[] = [];\n\tlet _deferredRenderCallbacks: Function[] = [];\n\tlet parentInvalidate: () => void;\n\tlet _allMergedNodes: Node[] = [];\n\n\tfunction nodeOperation(\n\t\tpropName: string,\n\t\tpropValue: (() => boolean) | boolean,\n\t\tpreviousValue: boolean,\n\t\tdomNode: HTMLElement & { [index: string]: any }\n\t): void {\n\t\tlet result = propValue && !previousValue;\n\t\tif (typeof propValue === 'function') {\n\t\t\tresult = propValue();\n\t\t}\n\t\tif (result === true) {\n\t\t\t_deferredRenderCallbacks.push(() => {\n\t\t\t\tdomNode[propName]();\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction updateEvent(\n\t\tdomNode: Node,\n\t\teventName: string,\n\t\tcurrentValue: (event: Event) => void,\n\t\tpreviousValue?: Function\n\t) {\n\t\tif (previousValue) {\n\t\t\tconst previousEvent = _eventMap.get(previousValue);\n\t\t\tpreviousEvent && domNode.removeEventListener(eventName, previousEvent);\n\t\t}\n\n\t\tlet callback = currentValue;\n\n\t\tif (eventName === 'input') {\n\t\t\tcallback = function(this: any, evt: Event) {\n\t\t\t\tcurrentValue.call(this, evt);\n\t\t\t\t(evt.target as any)['oninput-value'] = (evt.target as HTMLInputElement).value;\n\t\t\t};\n\t\t}\n\n\t\tdomNode.addEventListener(eventName, callback);\n\t\t_eventMap.set(currentValue, callback);\n\t}\n\n\tfunction removeOrphanedEvents(\n\t\tdomNode: Element,\n\t\tpreviousProperties: VNodeProperties,\n\t\tproperties: VNodeProperties,\n\t\tonlyEvents: boolean = false\n\t) {\n\t\tObject.keys(previousProperties).forEach((propName) => {\n\t\t\tconst isEvent = propName.substr(0, 2) === 'on' || onlyEvents;\n\t\t\tconst eventName = onlyEvents ? propName : propName.substr(2);\n\t\t\tif (isEvent && !properties[propName]) {\n\t\t\t\tconst eventCallback = _eventMap.get(previousProperties[propName]);\n\t\t\t\tif (eventCallback) {\n\t\t\t\t\tdomNode.removeEventListener(eventName, eventCallback);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction resolveRegistryItem(wrapper: WNodeWrapper, instance?: any, id?: string) {\n\t\tif (!isWidget(wrapper.node.widgetConstructor)) {\n\t\t\tconst owningNode = _nodeToWrapperMap.get(wrapper.node);\n\t\t\tif (owningNode) {\n\t\t\t\tif (owningNode.instance) {\n\t\t\t\t\tinstance = owningNode.instance;\n\t\t\t\t} else {\n\t\t\t\t\tid = owningNode.id;\n\t\t\t\t}\n\t\t\t}\n\t\t\tlet registry: RegistryHandler | undefined;\n\t\t\tif (instance) {\n\t\t\t\tconst instanceData = widgetInstanceMap.get(instance);\n\t\t\t\tif (instanceData) {\n\t\t\t\t\tregistry = instanceData.registry;\n\t\t\t\t}\n\t\t\t} else if (id !== undefined) {\n\t\t\t\tconst widgetMeta = widgetMetaMap.get(id);\n\t\t\t\tif (widgetMeta) {\n\t\t\t\t\tif (!widgetMeta.registryHandler) {\n\t\t\t\t\t\twidgetMeta.registryHandler = new RegistryHandler();\n\t\t\t\t\t\twidgetMeta.registryHandler.base = widgetMeta.registry;\n\t\t\t\t\t\twidgetMeta.registryHandler.on('invalidate', widgetMeta.invalidator);\n\t\t\t\t\t}\n\t\t\t\t\tregistry = widgetMeta.registryHandler;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (registry) {\n\t\t\t\tlet registryLabel: symbol | string;\n\t\t\t\tif (isLazyDefine(wrapper.node.widgetConstructor)) {\n\t\t\t\t\tconst { label, registryItem } = wrapper.node.widgetConstructor;\n\t\t\t\t\tif (!registry.has(label)) {\n\t\t\t\t\t\tregistry.define(label, registryItem);\n\t\t\t\t\t}\n\t\t\t\t\tregistryLabel = label;\n\t\t\t\t} else {\n\t\t\t\t\tregistryLabel = wrapper.node.widgetConstructor as any;\n\t\t\t\t}\n\t\t\t\tlet item = registry.get(registryLabel) as any;\n\t\t\t\tif (isWNodeFactory(item)) {\n\t\t\t\t\tconst node = item(wrapper.node.properties, wrapper.node.children);\n\t\t\t\t\tif (isWidgetFunction(node.widgetConstructor)) {\n\t\t\t\t\t\twrapper.registryItem = node.widgetConstructor;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\twrapper.registryItem = item;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction mapNodeToInstance(nodes: DNode[], wrapper: WNodeWrapper) {\n\t\twhile (nodes.length) {\n\t\t\tlet node = nodes.pop();\n\t\t\tif (isWNode(node) || isVNode(node)) {\n\t\t\t\tif (!_nodeToWrapperMap.has(node)) {\n\t\t\t\t\t_nodeToWrapperMap.set(node, wrapper);\n\t\t\t\t\tif (node.children && node.children.length) {\n\t\t\t\t\t\tnodes = [...nodes, ...node.children];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction renderedToWrapper(\n\t\trendered: DNode[],\n\t\tparent: DNodeWrapper,\n\t\tcurrentParent: DNodeWrapper | null\n\t): DNodeWrapper[] {\n\t\tconst { requiresInsertBefore, hasPreviousSiblings, namespace, depth } = parent;\n\t\tconst wrappedRendered: DNodeWrapper[] = [];\n\t\tconst hasParentWNode = isWNodeWrapper(parent);\n\t\tconst hasVirtualParentNode = isVirtualWrapper(parent);\n\t\tconst currentParentChildren =\n\t\t\t(isVNodeWrapper(currentParent) && _idToChildrenWrappers.get(currentParent.id)) || [];\n\t\tconst hasCurrentParentChildren = currentParentChildren.length > 0;\n\t\tconst insertBefore =\n\t\t\t((requiresInsertBefore || hasPreviousSiblings !== false) && (hasParentWNode || hasVirtualParentNode)) ||\n\t\t\t(hasCurrentParentChildren && rendered.length > 1);\n\t\tlet previousItem: DNodeWrapper | undefined;\n\t\tif (isWNodeWrapper(parent) && rendered.length) {\n\t\t\tmapNodeToInstance([...rendered], parent);\n\t\t}\n\t\tfor (let i = 0; i < rendered.length; i++) {\n\t\t\tlet renderedItem = rendered[i];\n\t\t\tif (!renderedItem || renderedItem === true) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (typeof renderedItem === 'string') {\n\t\t\t\trenderedItem = toTextVNode(renderedItem);\n\t\t\t}\n\t\t\tconst owningNode = _nodeToWrapperMap.get(renderedItem);\n\t\t\tconst wrapper: DNodeWrapper = {\n\t\t\t\tnode: renderedItem,\n\t\t\t\tdepth: depth + 1,\n\t\t\t\torder: i,\n\t\t\t\tparentId: parent.id,\n\t\t\t\trequiresInsertBefore: insertBefore,\n\t\t\t\thasParentWNode,\n\t\t\t\tnamespace: namespace\n\t\t\t} as DNodeWrapper;\n\t\t\tif (isVNode(renderedItem)) {\n\t\t\t\tif (renderedItem.deferredPropertiesCallback) {\n\t\t\t\t\t(wrapper as VNodeWrapper).deferredProperties = renderedItem.deferredPropertiesCallback(false);\n\t\t\t\t}\n\t\t\t\tif (renderedItem.properties.exitAnimation) {\n\t\t\t\t\tparent.hasAnimations = true;\n\t\t\t\t\tlet nextParent = _idToWrapperMap.get(parent.parentId);\n\t\t\t\t\twhile (nextParent) {\n\t\t\t\t\t\tif (nextParent.hasAnimations) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tnextParent.hasAnimations = true;\n\t\t\t\t\t\tnextParent = _idToWrapperMap.get(nextParent.parentId);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (owningNode) {\n\t\t\t\twrapper.owningId = owningNode.id;\n\t\t\t}\n\t\t\tif (isWNode(renderedItem)) {\n\t\t\t\tresolveRegistryItem(wrapper as WNodeWrapper, (parent as any).instance, (parent as any).id);\n\t\t\t}\n\t\t\tif (previousItem) {\n\t\t\t\t_wrapperSiblingMap.set(previousItem, wrapper);\n\t\t\t}\n\t\t\twrappedRendered.push(wrapper);\n\t\t\tpreviousItem = wrapper;\n\t\t}\n\t\treturn wrappedRendered;\n\t}\n\n\tfunction findParentDomNode(currentNode: DNodeWrapper): Node | undefined {\n\t\tlet parentDomNode: Node | undefined;\n\t\tlet parentWrapper = _idToWrapperMap.get(currentNode.parentId);\n\n\t\twhile (!parentDomNode && parentWrapper) {\n\t\t\tif (\n\t\t\t\t!parentDomNode &&\n\t\t\t\tisVNodeWrapper(parentWrapper) &&\n\t\t\t\t!isVirtualWrapper(parentWrapper) &&\n\t\t\t\tparentWrapper.domNode\n\t\t\t) {\n\t\t\t\tparentDomNode = parentWrapper.domNode;\n\t\t\t}\n\t\t\tparentWrapper = _idToWrapperMap.get(parentWrapper.parentId);\n\t\t}\n\t\treturn parentDomNode;\n\t}\n\n\tfunction runDeferredProperties(next: VNodeWrapper) {\n\t\tconst { deferredPropertiesCallback } = next.node;\n\t\tif (deferredPropertiesCallback) {\n\t\t\tconst properties = next.node.properties;\n\t\t\t_deferredRenderCallbacks.push(() => {\n\t\t\t\tif (_idToWrapperMap.has(next.owningId)) {\n\t\t\t\t\tconst deferredProperties = next.deferredProperties;\n\t\t\t\t\tnext.deferredProperties = deferredPropertiesCallback(true);\n\t\t\t\t\tprocessProperties(next, {\n\t\t\t\t\t\tproperties: { ...deferredProperties, ...properties }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction findInsertBefore(next: DNodeWrapper) {\n\t\tlet insertBefore: Node | null = null;\n\t\tlet searchNode: DNodeWrapper | undefined = next;\n\t\twhile (!insertBefore) {\n\t\t\tconst nextSibling = _wrapperSiblingMap.get(searchNode);\n\t\t\tif (nextSibling) {\n\t\t\t\tlet domNode = nextSibling.domNode;\n\t\t\t\tif ((isWNodeWrapper(nextSibling) || isVirtualWrapper(nextSibling)) && nextSibling.childDomWrapperId) {\n\t\t\t\t\tconst childWrapper = _idToWrapperMap.get(nextSibling.childDomWrapperId);\n\t\t\t\t\tif (childWrapper) {\n\t\t\t\t\t\tdomNode = childWrapper.domNode;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (domNode && domNode.parentNode) {\n\t\t\t\t\tinsertBefore = domNode;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tsearchNode = nextSibling;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tsearchNode = searchNode && _idToWrapperMap.get(searchNode.parentId);\n\t\t\tif (!searchNode || (isVNodeWrapper(searchNode) && !isVirtualWrapper(searchNode))) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn insertBefore;\n\t}\n\n\tfunction setValue(domNode: any, propValue?: any, previousValue?: any) {\n\t\tconst domValue = domNode.value;\n\t\tconst onInputValue = domNode['oninput-value'];\n\t\tconst onSelectValue = domNode['select-value'];\n\n\t\tif (onSelectValue && domValue !== onSelectValue) {\n\t\t\tdomNode.value = onSelectValue;\n\t\t\tif (domNode.value === onSelectValue) {\n\t\t\t\tdomNode['select-value'] = undefined;\n\t\t\t}\n\t\t} else if ((onInputValue && domValue === onInputValue) || propValue !== previousValue) {\n\t\t\tdomNode.value = propValue;\n\t\t\tdomNode['oninput-value'] = undefined;\n\t\t}\n\t}\n\n\tfunction setProperties(\n\t\tdomNode: HTMLElement,\n\t\tcurrentProperties: VNodeProperties = {},\n\t\tnextWrapper: VNodeWrapper,\n\t\tincludesEventsAndAttributes = true\n\t): void {\n\t\tconst properties = nextWrapper.deferredProperties\n\t\t\t? { ...nextWrapper.deferredProperties, ...nextWrapper.node.properties }\n\t\t\t: nextWrapper.node.properties;\n\t\tconst propNames = Object.keys(properties);\n\t\tconst propCount = propNames.length;\n\t\tif (propNames.indexOf('classes') === -1 && currentProperties.classes) {\n\t\t\tdomNode.removeAttribute('class');\n\t\t}\n\n\t\tincludesEventsAndAttributes && removeOrphanedEvents(domNode, currentProperties, properties);\n\n\t\tfor (let i = 0; i < propCount; i++) {\n\t\t\tconst propName = propNames[i];\n\t\t\tlet propValue = properties[propName];\n\t\t\tconst previousValue = currentProperties[propName];\n\t\t\tif (propName === 'classes') {\n\t\t\t\tconst previousClassString = createClassPropValue(previousValue);\n\t\t\t\tlet currentClassString = createClassPropValue(propValue);\n\t\t\t\tif (previousClassString !== currentClassString) {\n\t\t\t\t\tif (currentClassString) {\n\t\t\t\t\t\tif (nextWrapper.merged) {\n\t\t\t\t\t\t\tconst domClasses = (domNode.getAttribute('class') || '').split(' ');\n\t\t\t\t\t\t\tfor (let i = 0; i < domClasses.length; i++) {\n\t\t\t\t\t\t\t\tif (currentClassString.indexOf(domClasses[i]) === -1) {\n\t\t\t\t\t\t\t\t\tcurrentClassString = `${domClasses[i]} ${currentClassString}`;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdomNode.setAttribute('class', currentClassString);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdomNode.removeAttribute('class');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (nodeOperations.indexOf(propName) !== -1) {\n\t\t\t\tnodeOperation(propName, propValue, previousValue, domNode);\n\t\t\t} else if (propName === 'styles') {\n\t\t\t\tconst styleNames = Object.keys(propValue);\n\t\t\t\tconst styleCount = styleNames.length;\n\t\t\t\tfor (let j = 0; j < styleCount; j++) {\n\t\t\t\t\tconst styleName = styleNames[j];\n\t\t\t\t\tconst newStyleValue = propValue[styleName];\n\t\t\t\t\tconst oldStyleValue = previousValue && previousValue[styleName];\n\t\t\t\t\tif (newStyleValue === oldStyleValue) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\t(domNode.style as any)[styleName] = newStyleValue || '';\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!propValue && typeof previousValue === 'string') {\n\t\t\t\t\tpropValue = '';\n\t\t\t\t}\n\t\t\t\tif (propName === 'value') {\n\t\t\t\t\tif ((domNode as HTMLElement).tagName === 'SELECT') {\n\t\t\t\t\t\t(domNode as any)['select-value'] = propValue;\n\t\t\t\t\t}\n\t\t\t\t\tsetValue(domNode, propValue, previousValue);\n\t\t\t\t} else if (propName !== 'key' && propValue !== previousValue) {\n\t\t\t\t\tconst type = typeof propValue;\n\t\t\t\t\tif (type === 'function' && propName.lastIndexOf('on', 0) === 0 && includesEventsAndAttributes) {\n\t\t\t\t\t\tupdateEvent(domNode, propName.substr(2), propValue, previousValue);\n\t\t\t\t\t} else if (type === 'string' && propName !== 'innerHTML' && includesEventsAndAttributes) {\n\t\t\t\t\t\tupdateAttribute(domNode, propName, propValue, nextWrapper.namespace);\n\t\t\t\t\t} else if (propName === 'scrollLeft' || propName === 'scrollTop') {\n\t\t\t\t\t\tif ((domNode as any)[propName] !== propValue) {\n\t\t\t\t\t\t\t(domNode as any)[propName] = propValue;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\t(domNode as any)[propName] = propValue;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction runDeferredRenderCallbacks() {\n\t\tconst { sync } = _mountOptions;\n\t\tconst callbacks = _deferredRenderCallbacks;\n\t\t_deferredRenderCallbacks = [];\n\t\tif (callbacks.length) {\n\t\t\tconst run = () => {\n\t\t\t\tlet callback: Function | undefined;\n\t\t\t\twhile ((callback = callbacks.shift())) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (sync) {\n\t\t\t\trun();\n\t\t\t} else {\n\t\t\t\tglobal.requestAnimationFrame(run);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction runAfterRenderCallbacks() {\n\t\tconst { sync } = _mountOptions;\n\t\tconst callbacks = _idleCallbacks;\n\t\t_idleCallbacks = [];\n\t\tif (callbacks.length) {\n\t\t\tconst run = () => {\n\t\t\t\tlet callback: Function | undefined;\n\t\t\t\twhile ((callback = callbacks.shift())) {\n\t\t\t\t\tcallback();\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (sync) {\n\t\t\t\trun();\n\t\t\t} else {\n\t\t\t\tif (global.requestIdleCallback) {\n\t\t\t\t\tglobal.requestIdleCallback(run);\n\t\t\t\t} else {\n\t\t\t\t\tsetTimeout(run);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction processProperties(next: VNodeWrapper, previousProperties: PreviousProperties) {\n\t\tif (next.node.attributes && next.node.events) {\n\t\t\tupdateAttributes(\n\t\t\t\tnext.domNode as HTMLElement,\n\t\t\t\tpreviousProperties.attributes || {},\n\t\t\t\tnext.node.attributes,\n\t\t\t\tnext.namespace\n\t\t\t);\n\t\t\tsetProperties(next.domNode as HTMLElement, previousProperties.properties, next, false);\n\t\t\tconst events = next.node.events || {};\n\t\t\tif (previousProperties.events) {\n\t\t\t\tremoveOrphanedEvents(\n\t\t\t\t\tnext.domNode as HTMLElement,\n\t\t\t\t\tpreviousProperties.events || {},\n\t\t\t\t\tnext.node.events,\n\t\t\t\t\ttrue\n\t\t\t\t);\n\t\t\t}\n\t\t\tpreviousProperties.events = previousProperties.events || {};\n\t\t\tObject.keys(events).forEach((event) => {\n\t\t\t\tupdateEvent(next.domNode as HTMLElement, event, events[event], previousProperties.events[event]);\n\t\t\t});\n\t\t} else {\n\t\t\tsetProperties(next.domNode as HTMLElement, previousProperties.properties, next);\n\t\t}\n\t}\n\n\tfunction mount(mountOptions: Partial<MountOptions> = {}) {\n\t\t_mountOptions = { ..._mountOptions, ...mountOptions };\n\t\tconst { domNode } = _mountOptions;\n\t\tconst renderResult = wrapNodes(renderer)({});\n\t\tconst nextWrapper = {\n\t\t\tid: `${wrapperId++}`,\n\t\t\tnode: renderResult,\n\t\t\torder: 0,\n\t\t\tdepth: 1,\n\t\t\towningId: '-1',\n\t\t\tparentId: '-1',\n\t\t\tsiblingId: '-1',\n\t\t\tproperties: {}\n\t\t};\n\t\t_idToWrapperMap.set('-1', {\n\t\t\tid: `-1`,\n\t\t\tdepth: 0,\n\t\t\torder: 0,\n\t\t\towningId: '',\n\t\t\tdomNode,\n\t\t\tnode: v('fake'),\n\t\t\tparentId: '-1'\n\t\t});\n\t\t_processQueue.push({\n\t\t\tcurrent: [],\n\t\t\tnext: [nextWrapper],\n\t\t\tmeta: { mergeNodes: arrayFrom(domNode.childNodes) }\n\t\t});\n\t\t_runProcessQueue();\n\t\t_runDomInstructionQueue();\n\t\t_cleanUpMergedNodes();\n\t\t_insertBeforeMap = undefined;\n\t\t_runCallbacks();\n\t}\n\n\tfunction invalidate() {\n\t\tparentInvalidate && parentInvalidate();\n\t}\n\n\tfunction _schedule(): void {\n\t\tconst { sync } = _mountOptions;\n\t\tif (sync) {\n\t\t\t_runInvalidationQueue();\n\t\t} else if (!_renderScheduled) {\n\t\t\t_renderScheduled = global.requestAnimationFrame(() => {\n\t\t\t\t_runInvalidationQueue();\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction getWNodeWrapper(id: string) {\n\t\tconst wrapper = _idToWrapperMap.get(id);\n\t\tif (wrapper && isWNodeWrapper(wrapper)) {\n\t\t\treturn wrapper;\n\t\t}\n\t}\n\n\tfunction _runInvalidationQueue() {\n\t\t_renderScheduled = undefined;\n\t\tlet invalidationQueue = [..._invalidationQueue];\n\t\tconst previouslyRendered = [];\n\t\t_invalidationQueue = [];\n\t\tinvalidationQueue.sort((a, b) => {\n\t\t\tlet result = b.depth - a.depth;\n\t\t\tif (result === 0) {\n\t\t\t\tresult = b.order - a.order;\n\t\t\t}\n\t\t\treturn result;\n\t\t});\n\t\tif (_deferredProcessQueue.length) {\n\t\t\t_processQueue = [..._deferredProcessQueue];\n\t\t\t_deferredProcessQueue = [];\n\t\t\t_runProcessQueue();\n\t\t\tif (_deferredProcessQueue.length) {\n\t\t\t\t_invalidationQueue = [...invalidationQueue];\n\t\t\t\tinvalidationQueue = [];\n\t\t\t}\n\t\t}\n\t\tlet item: InvalidationQueueItem | undefined;\n\t\twhile ((item = invalidationQueue.pop())) {\n\t\t\tlet { id } = item;\n\t\t\tconst current = getWNodeWrapper(id);\n\t\t\tif (!current || previouslyRendered.indexOf(id) !== -1 || !_idToWrapperMap.has(current.parentId)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tpreviouslyRendered.push(id);\n\t\t\tconst sibling = _wrapperSiblingMap.get(current);\n\t\t\tconst next = {\n\t\t\t\tnode: {\n\t\t\t\t\ttype: WNODE,\n\t\t\t\t\twidgetConstructor: current.node.widgetConstructor,\n\t\t\t\t\tproperties: current.properties || {},\n\t\t\t\t\tchildren: current.node.children || []\n\t\t\t\t},\n\t\t\t\tinstance: current.instance,\n\t\t\t\tid: current.id,\n\t\t\t\tproperties: current.properties,\n\t\t\t\tdepth: current.depth,\n\t\t\t\torder: current.order,\n\t\t\t\towningId: current.owningId,\n\t\t\t\tparentId: current.parentId,\n\t\t\t\tregistryItem: current.registryItem\n\t\t\t};\n\n\t\t\tsibling && _wrapperSiblingMap.set(next, sibling);\n\t\t\tconst result = _updateWidget({ current, next });\n\t\t\tif (result && result.item) {\n\t\t\t\t_processQueue.push(result.item);\n\t\t\t\t_idToWrapperMap.set(id, next);\n\t\t\t\t_runProcessQueue();\n\t\t\t}\n\t\t}\n\t\t_runDomInstructionQueue();\n\t\t_cleanUpMergedNodes();\n\t\t_runCallbacks();\n\t}\n\n\tfunction _cleanUpMergedNodes() {\n\t\tif (_deferredProcessQueue.length === 0) {\n\t\t\tlet mergedNode: Node | undefined;\n\t\t\twhile ((mergedNode = _allMergedNodes.pop())) {\n\t\t\t\tmergedNode.parentNode && mergedNode.parentNode.removeChild(mergedNode);\n\t\t\t}\n\t\t\t_mountOptions.merge = false;\n\t\t}\n\t}\n\n\tfunction _runProcessQueue() {\n\t\tlet item: DetachApplication | AttachApplication | ProcessItem | undefined;\n\t\twhile ((item = _processQueue.pop())) {\n\t\t\tif (isAttachApplication(item)) {\n\t\t\t\titem.type === 'attach' && setDomNodeOnParentWrapper(item.id);\n\t\t\t\tif (item.instance) {\n\t\t\t\t\t_applicationQueue.push(item as any);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst { current, next, meta } = item;\n\t\t\t\t_process(current || EMPTY_ARRAY, next || EMPTY_ARRAY, meta);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _runDomInstructionQueue(): void {\n\t\t_applicationQueue.reverse();\n\t\tlet item: ApplicationInstruction | undefined;\n\t\twhile ((item = _applicationQueue.pop())) {\n\t\t\tif (item.type === 'create') {\n\t\t\t\tconst {\n\t\t\t\t\tparentDomNode,\n\t\t\t\t\tnext,\n\t\t\t\t\tnext: { domNode, merged, requiresInsertBefore, node }\n\t\t\t\t} = item;\n\n\t\t\t\tprocessProperties(next, { properties: {} });\n\t\t\t\trunDeferredProperties(next);\n\t\t\t\tif (!merged) {\n\t\t\t\t\tlet insertBefore: any;\n\t\t\t\t\tif (requiresInsertBefore) {\n\t\t\t\t\t\tinsertBefore = findInsertBefore(next);\n\t\t\t\t\t} else if (_insertBeforeMap) {\n\t\t\t\t\t\tinsertBefore = _insertBeforeMap.get(next);\n\t\t\t\t\t}\n\t\t\t\t\tparentDomNode.insertBefore(domNode!, insertBefore);\n\t\t\t\t\tif (isDomVNode(next.node) && next.node.onAttach) {\n\t\t\t\t\t\tnext.node.onAttach();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif ((domNode as HTMLElement).tagName === 'OPTION' && domNode!.parentElement) {\n\t\t\t\t\tsetValue(domNode!.parentElement);\n\t\t\t\t}\n\t\t\t\tconst { enterAnimation, enterAnimationActive } = node.properties;\n\t\t\t\tif (_mountOptions.transition && enterAnimation && enterAnimation !== true) {\n\t\t\t\t\t_mountOptions.transition.enter(domNode as HTMLElement, enterAnimation, enterAnimationActive);\n\t\t\t\t}\n\t\t\t\tconst owningWrapper = _nodeToWrapperMap.get(next.node);\n\t\t\t\tif (owningWrapper && node.properties.key != null) {\n\t\t\t\t\tif (owningWrapper.instance) {\n\t\t\t\t\t\tconst instanceData = widgetInstanceMap.get(owningWrapper.instance);\n\t\t\t\t\t\tinstanceData && instanceData.nodeHandler.add(domNode as HTMLElement, `${node.properties.key}`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\taddNodeToMap(owningWrapper.id, node.properties.key, domNode as HTMLElement);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\titem.next.inserted = true;\n\t\t\t} else if (item.type === 'update') {\n\t\t\t\tconst {\n\t\t\t\t\tnext,\n\t\t\t\t\tnext: { domNode },\n\t\t\t\t\tcurrent,\n\t\t\t\t\tcurrent: { domNode: currentDomNode }\n\t\t\t\t} = item;\n\t\t\t\tif (isTextNode(domNode) && isTextNode(currentDomNode) && domNode !== currentDomNode) {\n\t\t\t\t\tcurrentDomNode.parentNode && currentDomNode.parentNode.replaceChild(domNode, currentDomNode);\n\t\t\t\t} else {\n\t\t\t\t\tconst previousProperties = buildPreviousProperties(domNode, current);\n\t\t\t\t\tprocessProperties(next, previousProperties);\n\t\t\t\t\trunDeferredProperties(next);\n\t\t\t\t}\n\t\t\t} else if (item.type === 'delete') {\n\t\t\t\tconst { current } = item;\n\t\t\t\tconst { exitAnimation, exitAnimationActive } = current.node.properties;\n\t\t\t\tif (_mountOptions.transition && exitAnimation && exitAnimation !== true) {\n\t\t\t\t\t_mountOptions.transition.exit(current.domNode as HTMLElement, exitAnimation, exitAnimationActive);\n\t\t\t\t} else {\n\t\t\t\t\tcurrent.domNode!.parentNode!.removeChild(current.domNode!);\n\t\t\t\t}\n\t\t\t} else if (item.type === 'attach') {\n\t\t\t\tconst { instance, attached } = item;\n\t\t\t\tconst instanceData = widgetInstanceMap.get(instance);\n\t\t\t\tif (instanceData) {\n\t\t\t\t\tinstanceData.nodeHandler.addRoot();\n\t\t\t\t\tattached && instanceData.onAttach();\n\t\t\t\t}\n\t\t\t} else if (item.type === 'detach') {\n\t\t\t\tif (item.current.instance) {\n\t\t\t\t\tconst instanceData = widgetInstanceMap.get(item.current.instance);\n\t\t\t\t\tinstanceData && instanceData.onDetach();\n\t\t\t\t}\n\t\t\t\titem.current.instance = undefined;\n\t\t\t}\n\t\t}\n\t\tif (_deferredProcessQueue.length === 0) {\n\t\t\t_nodeToWrapperMap = new WeakMap();\n\t\t}\n\t}\n\n\tfunction _runCallbacks() {\n\t\trunAfterRenderCallbacks();\n\t\trunDeferredRenderCallbacks();\n\t}\n\n\tfunction _processMergeNodes(next: DNodeWrapper, mergeNodes: Node[]) {\n\t\tconst { merge } = _mountOptions;\n\t\tif (merge && mergeNodes.length) {\n\t\t\tif (isVNodeWrapper(next)) {\n\t\t\t\tlet {\n\t\t\t\t\tnode: { tag }\n\t\t\t\t} = next;\n\t\t\t\tfor (let i = 0; i < mergeNodes.length; i++) {\n\t\t\t\t\tconst domElement = mergeNodes[i] as Element;\n\t\t\t\t\tconst tagName = domElement.tagName || '';\n\t\t\t\t\tif (tag.toUpperCase() === tagName.toUpperCase()) {\n\t\t\t\t\t\tconst mergeNodeIndex = _allMergedNodes.indexOf(domElement);\n\t\t\t\t\t\tif (mergeNodeIndex !== -1) {\n\t\t\t\t\t\t\t_allMergedNodes.splice(mergeNodeIndex, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tmergeNodes.splice(i, 1);\n\t\t\t\t\t\tnext.domNode = domElement;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tnext.mergeNodes = mergeNodes;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction registerDistinguishableCallback(childNodes: DNodeWrapper[], index: number) {\n\t\t_idleCallbacks.push(() => {\n\t\t\tconst parentWNodeWrapper = getWNodeWrapper(childNodes[index].owningId);\n\t\t\tcheckDistinguishable(childNodes, index, parentWNodeWrapper);\n\t\t});\n\t}\n\n\tfunction createKeyMap(wrappers: DNodeWrapper[]): (string | number)[] | false {\n\t\tconst keys: (string | number)[] = [];\n\t\tfor (let i = 0; i < wrappers.length; i++) {\n\t\t\tconst wrapper = wrappers[i];\n\t\t\tif (wrapper.node.properties.key != null) {\n\t\t\t\tkeys.push(wrapper.node.properties.key);\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t\treturn keys;\n\t}\n\n\tfunction _process(current: DNodeWrapper[], next: DNodeWrapper[], meta: ProcessMeta = {}): void {\n\t\tlet { mergeNodes = [], oldIndex = 0, newIndex = 0 } = meta;\n\t\tconst currentLength = current.length;\n\t\tconst nextLength = next.length;\n\t\tconst hasPreviousSiblings = currentLength > 1 || (currentLength > 0 && currentLength < nextLength);\n\t\tlet instructions: Instruction[] = [];\n\t\tlet replace = false;\n\t\tif (oldIndex === 0 && newIndex === 0 && currentLength) {\n\t\t\tconst currentKeys = createKeyMap(current);\n\t\t\tif (currentKeys) {\n\t\t\t\tconst nextKeys = createKeyMap(next);\n\t\t\t\tif (nextKeys) {\n\t\t\t\t\tfor (let i = 0; i < currentKeys.length; i++) {\n\t\t\t\t\t\tif (nextKeys.indexOf(currentKeys[i]) !== -1) {\n\t\t\t\t\t\t\tinstructions = [];\n\t\t\t\t\t\t\treplace = false;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treplace = true;\n\t\t\t\t\t\tinstructions.push({ current: current[i], next: undefined });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (replace || (currentLength === 0 && !_mountOptions.merge)) {\n\t\t\tfor (let i = 0; i < next.length; i++) {\n\t\t\t\tinstructions.push({ current: undefined, next: next[i] });\n\t\t\t}\n\t\t} else {\n\t\t\tif (newIndex < nextLength) {\n\t\t\t\tlet currentWrapper = oldIndex < currentLength ? current[oldIndex] : undefined;\n\t\t\t\tconst nextWrapper = next[newIndex];\n\t\t\t\tnextWrapper.hasPreviousSiblings = hasPreviousSiblings;\n\n\t\t\t\t_processMergeNodes(nextWrapper, mergeNodes);\n\n\t\t\t\tif (currentWrapper && same(currentWrapper, nextWrapper)) {\n\t\t\t\t\toldIndex++;\n\t\t\t\t\tnewIndex++;\n\t\t\t\t\tif (isVNodeWrapper(currentWrapper) && isVNodeWrapper(nextWrapper)) {\n\t\t\t\t\t\tnextWrapper.inserted = currentWrapper.inserted;\n\t\t\t\t\t}\n\t\t\t\t\tinstructions.push({ current: currentWrapper, next: nextWrapper });\n\t\t\t\t} else if (!currentWrapper || findIndexOfChild(current, nextWrapper, oldIndex + 1) === -1) {\n\t\t\t\t\thas('dojo-debug') && current.length && registerDistinguishableCallback(next, newIndex);\n\t\t\t\t\tinstructions.push({ current: undefined, next: nextWrapper });\n\t\t\t\t\tnewIndex++;\n\t\t\t\t} else if (findIndexOfChild(next, currentWrapper, newIndex + 1) === -1) {\n\t\t\t\t\thas('dojo-debug') && registerDistinguishableCallback(current, oldIndex);\n\t\t\t\t\tinstructions.push({ current: currentWrapper, next: undefined });\n\t\t\t\t\toldIndex++;\n\t\t\t\t} else {\n\t\t\t\t\thas('dojo-debug') && registerDistinguishableCallback(next, newIndex);\n\t\t\t\t\thas('dojo-debug') && registerDistinguishableCallback(current, oldIndex);\n\t\t\t\t\tinstructions.push({ current: currentWrapper, next: undefined });\n\t\t\t\t\tinstructions.push({ current: undefined, next: nextWrapper });\n\t\t\t\t\toldIndex++;\n\t\t\t\t\tnewIndex++;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (newIndex < nextLength) {\n\t\t\t\t_processQueue.push({ current, next, meta: { mergeNodes, oldIndex, newIndex } });\n\t\t\t}\n\t\t\tif (currentLength > oldIndex && newIndex >= nextLength) {\n\t\t\t\tfor (let i = oldIndex; i < currentLength; i++) {\n\t\t\t\t\thas('dojo-debug') && registerDistinguishableCallback(current, i);\n\t\t\t\t\tinstructions.push({ current: current[i], next: undefined });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfor (let i = 0; i < instructions.length; i++) {\n\t\t\tconst result = _processOne(instructions[i]);\n\t\t\tif (result === false) {\n\t\t\t\tif (_mountOptions.merge && mergeNodes.length) {\n\t\t\t\t\tif (newIndex < nextLength) {\n\t\t\t\t\t\t_processQueue.pop();\n\t\t\t\t\t}\n\t\t\t\t\t_processQueue.push({ next, current, meta });\n\t\t\t\t\t_deferredProcessQueue = _processQueue;\n\t\t\t\t\t_processQueue = [];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tconst { widget, item, dom } = result;\n\t\t\twidget && _processQueue.push(widget);\n\t\t\titem && _processQueue.push(item);\n\t\t\tdom && _applicationQueue.push(dom);\n\t\t}\n\t}\n\n\tfunction _processOne({ current, next }: Instruction): ProcessResult | false {\n\t\tif (current !== next) {\n\t\t\tif (!current && next) {\n\t\t\t\tif (isVNodeWrapper(next)) {\n\t\t\t\t\treturn _createDom({ next });\n\t\t\t\t} else {\n\t\t\t\t\treturn _createWidget({ next });\n\t\t\t\t}\n\t\t\t} else if (current && next) {\n\t\t\t\tif (isVNodeWrapper(current) && isVNodeWrapper(next)) {\n\t\t\t\t\treturn _updateDom({ current, next });\n\t\t\t\t} else if (isWNodeWrapper(current) && isWNodeWrapper(next)) {\n\t\t\t\t\treturn _updateWidget({ current, next });\n\t\t\t\t}\n\t\t\t} else if (current && !next) {\n\t\t\t\tif (isVNodeWrapper(current)) {\n\t\t\t\t\treturn _removeDom({ current });\n\t\t\t\t} else if (isWNodeWrapper(current)) {\n\t\t\t\t\treturn _removeWidget({ current });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn {};\n\t}\n\n\tfunction resolveMiddleware(\n\t\tmiddlewares: any,\n\t\tid: string,\n\t\tmiddlewareIds: string[] = []\n\t): { middlewares: any; ids: string[] } {\n\t\tconst keys = Object.keys(middlewares);\n\t\tconst results: any = {};\n\t\tconst uniqueId = `${id}-${metaId++}`;\n\t\tfor (let i = 0; i < keys.length; i++) {\n\t\t\tconst middleware = middlewares[keys[i]]();\n\t\t\tconst payload: any = {\n\t\t\t\tid: uniqueId,\n\t\t\t\tproperties: () => {\n\t\t\t\t\tconst widgetMeta = widgetMetaMap.get(id);\n\t\t\t\t\tif (widgetMeta) {\n\t\t\t\t\t\treturn { ...widgetMeta.properties };\n\t\t\t\t\t}\n\t\t\t\t\treturn {};\n\t\t\t\t},\n\t\t\t\tchildren: () => {\n\t\t\t\t\tconst widgetMeta = widgetMetaMap.get(id);\n\t\t\t\t\tif (widgetMeta) {\n\t\t\t\t\t\treturn widgetMeta.children;\n\t\t\t\t\t}\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (middleware.middlewares) {\n\t\t\t\tconst { middlewares: resolvedMiddleware } = resolveMiddleware(\n\t\t\t\t\tmiddleware.middlewares,\n\t\t\t\t\tid,\n\t\t\t\t\tmiddlewareIds\n\t\t\t\t);\n\t\t\t\tpayload.middleware = resolvedMiddleware;\n\t\t\t\tresults[keys[i]] = middleware.callback(payload);\n\t\t\t} else {\n\t\t\t\tresults[keys[i]] = middleware.callback(payload);\n\t\t\t}\n\t\t}\n\t\tmiddlewareIds.push(uniqueId);\n\t\treturn { middlewares: results, ids: middlewareIds };\n\t}\n\n\tfunction _createWidget({ next }: CreateWidgetInstruction): ProcessResult | false {\n\t\tlet {\n\t\t\tnode: { widgetConstructor }\n\t\t} = next;\n\t\tlet { registry } = _mountOptions;\n\t\tlet Constructor = next.registryItem || widgetConstructor;\n\t\tif (!isWidget(Constructor)) {\n\t\t\tresolveRegistryItem(next);\n\t\t\tif (!next.registryItem) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tConstructor = next.registryItem;\n\t\t}\n\n\t\tlet rendered: RenderResult;\n\t\tlet invalidate: () => void;\n\t\tnext.properties = next.node.properties;\n\t\tnext.id = next.id || `${wrapperId++}`;\n\t\t_idToWrapperMap.set(next.id, next);\n\t\tconst { id, depth, order } = next;\n\t\tif (!isWidgetBaseConstructor(Constructor)) {\n\t\t\tlet widgetMeta = widgetMetaMap.get(id);\n\t\t\tif (!widgetMeta) {\n\t\t\t\tinvalidate = () => {\n\t\t\t\t\tconst widgetMeta = widgetMetaMap.get(id);\n\t\t\t\t\tif (widgetMeta) {\n\t\t\t\t\t\twidgetMeta.dirty = true;\n\t\t\t\t\t\tif (!widgetMeta.rendering && _idToWrapperMap.has(id)) {\n\t\t\t\t\t\t\t_invalidationQueue.push({ id, depth, order });\n\t\t\t\t\t\t\t_schedule();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\twidgetMeta = {\n\t\t\t\t\tmountNode: _mountOptions.domNode,\n\t\t\t\t\tdirty: false,\n\t\t\t\t\tinvalidator: invalidate,\n\t\t\t\t\tproperties: next.node.properties,\n\t\t\t\t\tchildren: next.node.children,\n\t\t\t\t\tdeferRefs: 0,\n\t\t\t\t\trendering: true,\n\t\t\t\t\tmiddleware: {},\n\t\t\t\t\tmiddlewareIds: [],\n\t\t\t\t\tregistry: _mountOptions.registry\n\t\t\t\t};\n\n\t\t\t\twidgetMetaMap.set(next.id, widgetMeta);\n\t\t\t\tif ((Constructor as any).middlewares) {\n\t\t\t\t\tconst { middlewares, ids } = resolveMiddleware((Constructor as any).middlewares, id);\n\t\t\t\t\twidgetMeta.middleware = middlewares;\n\t\t\t\t\twidgetMeta.middlewareIds = ids;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tinvalidate = widgetMeta.invalidator;\n\t\t\t}\n\n\t\t\trendered = Constructor({\n\t\t\t\tid,\n\t\t\t\tproperties: () => next.node.properties,\n\t\t\t\tchildren: () => next.node.children,\n\t\t\t\tmiddleware: widgetMeta.middleware\n\t\t\t});\n\t\t\twidgetMeta.rendering = false;\n\t\t\tif (widgetMeta.deferRefs > 0) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\tlet instance = new Constructor() as WidgetBaseInterface & {\n\t\t\t\tinvalidate: any;\n\t\t\t\tregistry: any;\n\t\t\t};\n\t\t\tinstance.registry.base = registry;\n\t\t\tconst instanceData = widgetInstanceMap.get(instance)!;\n\t\t\tinvalidate = () => {\n\t\t\t\tinstanceData.dirty = true;\n\t\t\t\tif (!instanceData.rendering && _idToWrapperMap.has(id)) {\n\t\t\t\t\t_invalidationQueue.push({ id, depth, order });\n\t\t\t\t\t_schedule();\n\t\t\t\t}\n\t\t\t};\n\t\t\tinstanceData.invalidate = invalidate;\n\t\t\tinstanceData.rendering = true;\n\t\t\tinstance.__setProperties__(next.node.properties);\n\t\t\tinstance.__setChildren__(next.node.children);\n\t\t\tnext.instance = instance;\n\t\t\trendered = instance.__render__();\n\t\t\tinstanceData.rendering = false;\n\t\t}\n\n\t\tlet children: DNodeWrapper[] | undefined;\n\t\tif (rendered) {\n\t\t\trendered = Array.isArray(rendered) ? rendered : [rendered];\n\t\t\tchildren = renderedToWrapper(rendered, next, null);\n\t\t\t_idToChildrenWrappers.set(id, children);\n\t\t}\n\n\t\tif (!parentInvalidate && !(Constructor as any).isWNodeWrapper) {\n\t\t\tparentInvalidate = invalidate;\n\t\t}\n\n\t\treturn {\n\t\t\titem: {\n\t\t\t\tnext: children,\n\t\t\t\tmeta: { mergeNodes: next.mergeNodes }\n\t\t\t},\n\t\t\twidget: { type: 'attach', instance: next.instance, id, attached: true }\n\t\t};\n\t}\n\n\tfunction _updateWidget({ current, next }: UpdateWidgetInstruction): ProcessResult {\n\t\tcurrent = getWNodeWrapper(current.id) || current;\n\t\tconst { instance, domNode, hasAnimations } = current;\n\t\tlet {\n\t\t\tnode: { widgetConstructor }\n\t\t} = next;\n\t\tconst Constructor = next.registryItem || widgetConstructor;\n\n\t\tif (!isWidget(Constructor)) {\n\t\t\treturn {};\n\t\t}\n\t\tlet rendered: RenderResult;\n\t\tlet processResult: ProcessResult = {};\n\t\tlet didRender = false;\n\t\tlet currentChildren = _idToChildrenWrappers.get(current.id);\n\t\tnext.hasAnimations = hasAnimations;\n\t\tnext.id = current.id;\n\t\tnext.childDomWrapperId = current.childDomWrapperId;\n\t\tnext.properties = next.node.properties;\n\t\t_wrapperSiblingMap.delete(current);\n\t\tif (domNode && domNode.parentNode) {\n\t\t\tnext.domNode = domNode;\n\t\t}\n\n\t\tif (!isWidgetBaseConstructor(Constructor)) {\n\t\t\tconst widgetMeta = widgetMetaMap.get(next.id);\n\t\t\tif (widgetMeta) {\n\t\t\t\twidgetMeta.properties = next.properties;\n\t\t\t\twidgetMeta.rendering = true;\n\t\t\t\trunDiffs(widgetMeta, current.properties, next.properties);\n\t\t\t\tif (current.node.children.length > 0 || next.node.children.length > 0) {\n\t\t\t\t\twidgetMeta.dirty = true;\n\t\t\t\t}\n\t\t\t\tif (!widgetMeta.dirty) {\n\t\t\t\t\tpropertiesDiff(\n\t\t\t\t\t\tcurrent.properties,\n\t\t\t\t\t\tnext.properties,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\twidgetMeta.dirty = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\twidgetMeta.customDiffProperties ? [...widgetMeta.customDiffProperties.values()] : []\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tif (widgetMeta.dirty) {\n\t\t\t\t\t_idToChildrenWrappers.delete(next.id);\n\t\t\t\t\tdidRender = true;\n\t\t\t\t\twidgetMeta.dirty = false;\n\t\t\t\t\trendered = Constructor({\n\t\t\t\t\t\tid: next.id,\n\t\t\t\t\t\tproperties: () => next.node.properties,\n\t\t\t\t\t\tchildren: () => next.node.children,\n\t\t\t\t\t\tmiddleware: widgetMeta.middleware\n\t\t\t\t\t});\n\t\t\t\t\tif (widgetMeta.deferRefs > 0) {\n\t\t\t\t\t\trendered = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twidgetMeta.rendering = false;\n\t\t\t}\n\t\t} else {\n\t\t\tconst instanceData = widgetInstanceMap.get(instance!)!;\n\t\t\tnext.instance = instance;\n\t\t\tinstanceData.rendering = true;\n\t\t\tinstance!.__setProperties__(next.node.properties);\n\t\t\tinstance!.__setChildren__(next.node.children);\n\t\t\tif (instanceData.dirty) {\n\t\t\t\tdidRender = true;\n\t\t\t\t_idToChildrenWrappers.delete(next.id);\n\t\t\t\trendered = instance!.__render__();\n\t\t\t}\n\t\t\tinstanceData.rendering = false;\n\t\t}\n\t\t_idToWrapperMap.set(next.id, next);\n\t\tprocessResult.widget = { type: 'attach', instance, id: next.id, attached: false };\n\n\t\tlet children: DNodeWrapper[] | undefined;\n\t\tif (rendered) {\n\t\t\trendered = Array.isArray(rendered) ? rendered : [rendered];\n\t\t\tchildren = renderedToWrapper(rendered, next, current);\n\t\t\t_idToChildrenWrappers.set(next.id, children);\n\t\t}\n\n\t\tif (didRender) {\n\t\t\tprocessResult.item = {\n\t\t\t\tcurrent: currentChildren,\n\t\t\t\tnext: children,\n\t\t\t\tmeta: {}\n\t\t\t};\n\t\t}\n\t\treturn processResult;\n\t}\n\n\tfunction _removeWidget({ current }: RemoveWidgetInstruction): ProcessResult {\n\t\tcurrent = getWNodeWrapper(current.id) || current;\n\t\t_idToWrapperMap.delete(current.id);\n\t\tconst meta = widgetMetaMap.get(current.id);\n\t\tlet currentChildren = _idToChildrenWrappers.get(current.id);\n\t\t_idToChildrenWrappers.delete(current.id);\n\t\t_wrapperSiblingMap.delete(current);\n\t\tlet processResult: ProcessResult = {\n\t\t\titem: {\n\t\t\t\tcurrent: currentChildren,\n\t\t\t\tmeta: {}\n\t\t\t}\n\t\t};\n\t\tif (meta) {\n\t\t\tmeta.registryHandler && meta.registryHandler.destroy();\n\t\t\tdestroyHandles(meta);\n\t\t\twidgetMetaMap.delete(current.id);\n\t\t} else {\n\t\t\tprocessResult.widget = { type: 'detach', current, instance: current.instance };\n\t\t}\n\n\t\treturn processResult;\n\t}\n\n\tfunction setDomNodeOnParentWrapper(id: string) {\n\t\tlet wrapper = _idToWrapperMap.get(id)!;\n\t\tlet children = [...(_idToChildrenWrappers.get(id) || [])];\n\t\tlet child: DNodeWrapper | undefined;\n\t\twhile (children.length && !wrapper.domNode) {\n\t\t\tchild = children.shift();\n\t\t\tif (child) {\n\t\t\t\tif (child.domNode) {\n\t\t\t\t\twrapper.childDomWrapperId = child.id;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tlet nextChildren = _idToChildrenWrappers.get(child.id);\n\t\t\t\tif (nextChildren) {\n\t\t\t\t\tchildren = [...nextChildren, ...children];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction _createDom({ next }: CreateDomInstruction): ProcessResult {\n\t\tconst parentDomNode = findParentDomNode(next)!;\n\t\tconst isVirtual = isVirtualWrapper(next);\n\t\tconst isBody = isBodyWrapper(next);\n\t\tlet mergeNodes: Node[] = [];\n\t\tnext.id = `${wrapperId++}`;\n\t\t_idToWrapperMap.set(next.id, next);\n\t\tif (!next.domNode) {\n\t\t\tif ((next.node as any).domNode) {\n\t\t\t\tnext.domNode = (next.node as any).domNode;\n\t\t\t} else {\n\t\t\t\tif (next.node.tag === 'svg') {\n\t\t\t\t\tnext.namespace = NAMESPACE_SVG;\n\t\t\t\t}\n\t\t\t\tif (isBody) {\n\t\t\t\t\tnext.domNode = global.document.body;\n\t\t\t\t} else if (next.node.tag && !isVirtual) {\n\t\t\t\t\tif (next.namespace) {\n\t\t\t\t\t\tnext.domNode = global.document.createElementNS(next.namespace, next.node.tag);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnext.domNode = global.document.createElement(next.node.tag);\n\t\t\t\t\t}\n\t\t\t\t} else if (next.node.text != null) {\n\t\t\t\t\tnext.domNode = global.document.createTextNode(next.node.text);\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (_insertBeforeMap && _allMergedNodes.length) {\n\t\t\t\tif (parentDomNode === _allMergedNodes[0].parentNode) {\n\t\t\t\t\t_insertBeforeMap.set(next, _allMergedNodes[0]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (_mountOptions.merge) {\n\t\t\tnext.merged = true;\n\t\t\tif (isTextNode(next.domNode)) {\n\t\t\t\tif (next.domNode.data !== next.node.text) {\n\t\t\t\t\t_allMergedNodes = [next.domNode, ..._allMergedNodes];\n\t\t\t\t\tnext.domNode = global.document.createTextNode(next.node.text);\n\t\t\t\t\tnext.merged = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tmergeNodes = arrayFrom(next.domNode.childNodes);\n\t\t\t\t_allMergedNodes = [..._allMergedNodes, ...mergeNodes];\n\t\t\t}\n\t\t}\n\t\tlet children: DNodeWrapper[] | undefined;\n\t\tif (next.domNode || isVirtual) {\n\t\t\tif (next.node.children && next.node.children.length) {\n\t\t\t\tchildren = renderedToWrapper(next.node.children, next, null);\n\t\t\t\t_idToChildrenWrappers.set(next.id, children);\n\t\t\t}\n\t\t}\n\t\tconst dom: ApplicationInstruction | undefined =\n\t\t\tisVirtual || isBody\n\t\t\t\t? undefined\n\t\t\t\t: {\n\t\t\t\t\t\tnext: next!,\n\t\t\t\t\t\tparentDomNode: parentDomNode,\n\t\t\t\t\t\ttype: 'create'\n\t\t\t\t  };\n\t\tif (children) {\n\t\t\treturn {\n\t\t\t\titem: {\n\t\t\t\t\tcurrent: [],\n\t\t\t\t\tnext: children,\n\t\t\t\t\tmeta: { mergeNodes }\n\t\t\t\t},\n\t\t\t\tdom,\n\t\t\t\twidget: isVirtual ? { type: 'attach', id: (next as any).id, attached: false } : undefined\n\t\t\t};\n\t\t}\n\t\treturn { dom };\n\t}\n\n\tfunction _updateDom({ current, next }: UpdateDomInstruction): ProcessResult {\n\t\tnext.domNode = current.domNode;\n\t\tnext.namespace = current.namespace;\n\t\tnext.id = current.id;\n\t\tnext.childDomWrapperId = current.childDomWrapperId;\n\t\tlet children: DNodeWrapper[] | undefined;\n\t\tlet currentChildren = _idToChildrenWrappers.get(next.id);\n\t\tif (next.node.text != null && next.node.text !== current.node.text) {\n\t\t\tnext.domNode = global.document.createTextNode(next.node.text);\n\t\t} else if (next.node.children) {\n\t\t\tchildren = renderedToWrapper(next.node.children, next, current);\n\t\t\t_idToChildrenWrappers.set(next.id, children);\n\t\t}\n\t\t_wrapperSiblingMap.delete(current);\n\t\t_idToWrapperMap.set(next.id, next);\n\t\treturn {\n\t\t\titem: {\n\t\t\t\tcurrent: currentChildren,\n\t\t\t\tnext: children,\n\t\t\t\tmeta: {}\n\t\t\t},\n\t\t\tdom: { type: 'update', next, current }\n\t\t};\n\t}\n\n\tfunction _removeDom({ current }: RemoveDomInstruction): ProcessResult {\n\t\tconst isVirtual = isVirtualWrapper(current);\n\t\tconst isBody = isBodyWrapper(current);\n\t\tconst children = _idToChildrenWrappers.get(current.id);\n\t\t_idToChildrenWrappers.delete(current.id);\n\t\t_idToWrapperMap.delete(current.id);\n\t\t_wrapperSiblingMap.delete(current);\n\t\tif (current.node.properties.key) {\n\t\t\tconst widgetMeta = widgetMetaMap.get(current.owningId);\n\t\t\tconst parentWrapper = getWNodeWrapper(current.owningId);\n\t\t\tif (widgetMeta) {\n\t\t\t\twidgetMeta.nodeMap && widgetMeta.nodeMap.delete(current.node.properties.key);\n\t\t\t} else if (parentWrapper && parentWrapper.instance) {\n\t\t\t\tconst instanceData = widgetInstanceMap.get(parentWrapper.instance);\n\t\t\t\tinstanceData && instanceData.nodeHandler.remove(current.node.properties.key);\n\t\t\t}\n\t\t}\n\t\tif (current.hasAnimations || isVirtual || isBody) {\n\t\t\treturn {\n\t\t\t\titem: { current: children, meta: {} },\n\t\t\t\tdom: isVirtual || isBody ? undefined : { type: 'delete', current }\n\t\t\t};\n\t\t}\n\n\t\tif (children) {\n\t\t\t_deferredRenderCallbacks.push(() => {\n\t\t\t\tlet wrappers = children || [];\n\t\t\t\tlet wrapper: DNodeWrapper | undefined;\n\t\t\t\tlet bodyIds = [];\n\t\t\t\twhile ((wrapper = wrappers.pop())) {\n\t\t\t\t\tif (isWNodeWrapper(wrapper)) {\n\t\t\t\t\t\twrapper = getWNodeWrapper(wrapper.id) || wrapper;\n\t\t\t\t\t\tif (wrapper.instance) {\n\t\t\t\t\t\t\tconst instanceData = widgetInstanceMap.get(wrapper.instance);\n\t\t\t\t\t\t\tinstanceData && instanceData.onDetach();\n\t\t\t\t\t\t\twrapper.instance = undefined;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst meta = widgetMetaMap.get(wrapper.id);\n\t\t\t\t\t\t\tif (meta) {\n\t\t\t\t\t\t\t\tmeta.registryHandler && meta.registryHandler.destroy();\n\t\t\t\t\t\t\t\tdestroyHandles(meta);\n\t\t\t\t\t\t\t\twidgetMetaMap.delete(wrapper.id);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tlet wrapperChildren = _idToChildrenWrappers.get(wrapper.id);\n\t\t\t\t\tif (wrapperChildren) {\n\t\t\t\t\t\twrappers.push(...wrapperChildren);\n\t\t\t\t\t}\n\t\t\t\t\tif (isBodyWrapper(wrapper)) {\n\t\t\t\t\t\tbodyIds.push(wrapper.id);\n\t\t\t\t\t} else if (bodyIds.indexOf(wrapper.parentId) !== -1) {\n\t\t\t\t\t\tif (isWNodeWrapper(wrapper) || isVirtualWrapper(wrapper)) {\n\t\t\t\t\t\t\tbodyIds.push(wrapper.id);\n\t\t\t\t\t\t} else if (wrapper.domNode && wrapper.domNode.parentNode) {\n\t\t\t\t\t\t\twrapper.domNode.parentNode.removeChild(wrapper.domNode);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t_idToChildrenWrappers.delete(wrapper.id);\n\t\t\t\t\t_idToWrapperMap.delete(wrapper.id);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn {\n\t\t\tdom: { type: 'delete', current }\n\t\t};\n\t}\n\n\treturn {\n\t\tmount,\n\t\tinvalidate\n\t};\n}\n\nexport default renderer;\n"]}