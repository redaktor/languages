{"version":3,"file":"ActiveLink.js","sourceRoot":"","sources":["ActiveLink.ts"],"names":[],"mappings":"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","sourcesContent":["import { create, diffProperty, invalidator, w } from '../core/vdom';\nimport { Handle } from '../core/Destroyable';\nimport injector from '../core/middleware/injector';\nimport cache from '../core/middleware/cache';\nimport { SupportedClassName } from '../core/interfaces';\nimport Link, { LinkProperties } from './Link';\nimport Router from './Router';\n\nexport interface ActiveLinkProperties extends LinkProperties {\n\tactiveClasses: SupportedClassName[];\n}\n\nfunction paramsEqual(linkParams: any = {}, contextParams: any = {}) {\n\treturn Object.keys(linkParams).every((key) => linkParams[key] === contextParams[key]);\n}\n\nconst factory = create({ injector, diffProperty, cache, invalidator }).properties<ActiveLinkProperties>();\n\nexport const ActiveLink = factory(function ActiveLink({\n\tmiddleware: { diffProperty, injector, cache, invalidator },\n\tproperties,\n\tchildren\n}) {\n\tconst { to, routerKey = 'router', params } = properties();\n\tlet { activeClasses, classes = [], ...props } = properties();\n\n\tdiffProperty('to', (current: ActiveLinkProperties, next: ActiveLinkProperties) => {\n\t\tif (current.to !== next.to) {\n\t\t\tconst router = injector.get<Router>(routerKey);\n\t\t\tconst currentHandle = cache.get<Handle>('handle');\n\t\t\tif (currentHandle) {\n\t\t\t\tcurrentHandle.destroy();\n\t\t\t}\n\t\t\tif (router) {\n\t\t\t\tconst handle = router.on('outlet', ({ outlet }) => {\n\t\t\t\t\tif (outlet.id === to) {\n\t\t\t\t\t\tinvalidator();\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tcache.set('handle', handle);\n\t\t\t}\n\t\t\tinvalidator();\n\t\t}\n\t});\n\n\tconst router = injector.get<Router>(routerKey);\n\tif (router) {\n\t\tif (!cache.get('handle')) {\n\t\t\tconst handle = router.on('outlet', ({ outlet }) => {\n\t\t\t\tif (outlet.id === to) {\n\t\t\t\t\tinvalidator();\n\t\t\t\t}\n\t\t\t});\n\t\t\tcache.set('handle', handle);\n\t\t}\n\t\tconst context = router.getOutlet(to);\n\t\tconst isActive = context && paramsEqual(params, context.params);\n\n\t\tclasses = Array.isArray(classes) ? classes : [classes];\n\t\tif (isActive) {\n\t\t\tclasses = [...classes, ...activeClasses];\n\t\t}\n\t\tprops = { ...props, classes };\n\t}\n\treturn w(Link, props, children());\n});\n\nexport default ActiveLink;\n"]}