{"version":3,"file":"Outlet.mjs","sourceRoot":"","sources":["Outlet.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,cAAc,CAAC;AACjE,OAAO,QAAQ,MAAM,6BAA6B,CAAC;AACnD,OAAO,KAAK,MAAM,0BAA0B,CAAC;AAW7C,MAAM,OAAO,GAAG,MAAM,CAAC,EAAE,KAAK,EAAE,QAAQ,EAAE,YAAY,EAAE,WAAW,EAAE,CAAC,CAAC,UAAU,EAAoB,CAAC;AAEtG,MAAM,CAAC,MAAM,MAAM,GAAG,OAAO,CAAC,SAAS,MAAM,CAAC,EAC7C,UAAU,EAAE,EAAE,KAAK,EAAE,QAAQ,EAAE,YAAY,EAAE,WAAW,EAAE,EAC1D,UAAU,EACV;IACA,MAAM,EAAE,QAAQ,EAAE,EAAE,EAAE,SAAS,GAAG,QAAQ,EAAE,GAAG,UAAU,EAAE,CAAC;IAC5D,MAAM,aAAa,GAAG,KAAK,CAAC,GAAG,CAAW,QAAQ,CAAC,CAAC;IACpD,IAAI,CAAC,aAAa,EAAE;QACnB,MAAM,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAC7C,IAAI,MAAM,EAAE;YACX,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;SAC5B;KACD;IACD,YAAY,CAAC,WAAW,EAAE,CAAC,OAAyB,EAAE,IAAsB,EAAE,EAAE;QAC/E,MAAM,EAAE,SAAS,EAAE,gBAAgB,GAAG,QAAQ,EAAE,GAAG,OAAO,CAAC;QAC3D,MAAM,EAAE,SAAS,GAAG,QAAQ,EAAE,GAAG,IAAI,CAAC;QACtC,IAAI,SAAS,KAAK,gBAAgB,EAAE;YACnC,MAAM,aAAa,GAAG,KAAK,CAAC,GAAG,CAAW,QAAQ,CAAC,CAAC;YACpD,IAAI,aAAa,EAAE;gBAClB,aAAa,EAAE,CAAC;aAChB;YACD,MAAM,MAAM,GAAG,QAAQ,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;YAC7C,IAAI,MAAM,EAAE;gBACX,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;aAC5B;SACD;QACD,WAAW,EAAE,CAAC;IACf,CAAC,CAAC,CAAC;IACH,MAAM,MAAM,GAAG,QAAQ,CAAC,GAAG,CAAS,SAAS,CAAC,CAAC;IAE/C,IAAI,MAAM,EAAE;QACX,MAAM,aAAa,GAAG,MAAM,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QAC3C,IAAI,aAAa,EAAE;YAClB,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG,aAAa,CAAC;YACtE,MAAM,MAAM,GAAG,QAAQ,CAAC,EAAE,WAAW,EAAE,MAAM,EAAE,IAAI,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,CAAC;YACjF,IAAI,MAAM,EAAE;gBACX,OAAO,MAAM,CAAC;aACd;SACD;KACD;IACD,OAAO,IAAI,CAAC;AACb,CAAC,CAAC,CAAC;AAEH,eAAe,MAAM,CAAC","sourcesContent":["import { create, diffProperty, invalidator } from '../core/vdom';\nimport injector from '../core/middleware/injector';\nimport cache from '../core/middleware/cache';\nimport { DNode } from '../core/interfaces';\nimport { MatchDetails } from './interfaces';\nimport Router from './Router';\n\nexport interface OutletProperties {\n\trenderer: (matchDetails: MatchDetails) => DNode | DNode[];\n\tid: string;\n\trouterKey?: string;\n}\n\nconst factory = create({ cache, injector, diffProperty, invalidator }).properties<OutletProperties>();\n\nexport const Outlet = factory(function Outlet({\n\tmiddleware: { cache, injector, diffProperty, invalidator },\n\tproperties\n}) {\n\tconst { renderer, id, routerKey = 'router' } = properties();\n\tconst currentHandle = cache.get<Function>('handle');\n\tif (!currentHandle) {\n\t\tconst handle = injector.subscribe(routerKey);\n\t\tif (handle) {\n\t\t\tcache.set('handle', handle);\n\t\t}\n\t}\n\tdiffProperty('routerKey', (current: OutletProperties, next: OutletProperties) => {\n\t\tconst { routerKey: currentRouterKey = 'router' } = current;\n\t\tconst { routerKey = 'router' } = next;\n\t\tif (routerKey !== currentRouterKey) {\n\t\t\tconst currentHandle = cache.get<Function>('handle');\n\t\t\tif (currentHandle) {\n\t\t\t\tcurrentHandle();\n\t\t\t}\n\t\t\tconst handle = injector.subscribe(routerKey);\n\t\t\tif (handle) {\n\t\t\t\tcache.set('handle', handle);\n\t\t\t}\n\t\t}\n\t\tinvalidator();\n\t});\n\tconst router = injector.get<Router>(routerKey);\n\n\tif (router) {\n\t\tconst outletContext = router.getOutlet(id);\n\t\tif (outletContext) {\n\t\t\tconst { queryParams, params, type, isError, isExact } = outletContext;\n\t\t\tconst result = renderer({ queryParams, params, type, isError, isExact, router });\n\t\t\tif (result) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t}\n\treturn null;\n});\n\nexport default Outlet;\n"]}