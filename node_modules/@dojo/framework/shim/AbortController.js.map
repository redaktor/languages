{"version":3,"file":"AbortController.js","sourceRoot":"","sources":["AbortController.ts"],"names":[],"mappings":"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","sourcesContent":["import global from './global';\nimport has from '../core/has';\nimport { findIndex } from './array';\n\nexport interface AbortSignal extends EventTarget {\n\taborted: boolean;\n\tonabort: null | ((this: AbortSignal, ev: Event) => any);\n}\n\nexport interface AbortSignalConstructor {\n\treadonly prototype: AbortSignal;\n\tnew (): AbortSignal;\n}\n\n// tslint:disable-next-line variable-name\nexport let ShimAbortSignal: AbortSignalConstructor = global.AbortSignal;\n\nif (!has('abort-signal')) {\n\tglobal.AbortSignal = ShimAbortSignal = class implements AbortSignal {\n\t\tprivate _aborted = false;\n\t\tonabort: null | ((this: AbortSignal, ev: Event) => any) = null;\n\n\t\tlisteners: { [type: string]: ((event: Event) => void)[] } = {};\n\n\t\tget aborted(): boolean {\n\t\t\treturn this._aborted;\n\t\t}\n\n\t\taddEventListener(type: string, callback: (event: Event) => void): void {\n\t\t\tif (!(type in this.listeners)) {\n\t\t\t\tthis.listeners[type] = [];\n\t\t\t}\n\t\t\tthis.listeners[type].push(callback);\n\t\t}\n\n\t\tremoveEventListener(type: string, callback: (event: any) => void): void {\n\t\t\tif (!(type in this.listeners)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst index = findIndex(this.listeners[type], (cb: (event: any) => void) => cb === callback);\n\n\t\t\tif (index >= 0) {\n\t\t\t\tthis.listeners[type].splice(index, 1);\n\t\t\t}\n\t\t}\n\n\t\tdispatchEvent(event: Event): boolean {\n\t\t\tconst { type } = event;\n\t\t\tif (type === 'abort') {\n\t\t\t\tthis._aborted = true;\n\t\t\t\tif (typeof this.onabort === 'function') {\n\t\t\t\t\tthis.onabort.call(this, event);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!(type in this.listeners)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tthis.listeners[type].forEach((callback: (event: any) => void) => {\n\t\t\t\tsetTimeout(() => callback.call(this, event), 0);\n\t\t\t});\n\n\t\t\treturn !event.preventDefault;\n\t\t}\n\t};\n}\n\nexport interface AbortController {\n\treadonly signal: AbortSignal;\n\tabort(): void;\n}\n\nexport interface AbortControllerConstructor {\n\treadonly prototype: AbortController;\n\tnew (): AbortController;\n}\n\n// tslint:disable-next-line variable-name\nexport let ShimAbortController: AbortControllerConstructor = global.AbortController;\n\nif (!has('abort-controller')) {\n\tglobal.AbortController = ShimAbortController = class implements AbortController {\n\t\treadonly signal: AbortSignal = new ShimAbortSignal();\n\n\t\tabort(): void {\n\t\t\tlet event: Event;\n\t\t\ttry {\n\t\t\t\tevent = new Event('abort');\n\t\t\t} catch (e) {\n\t\t\t\tif (typeof document !== 'undefined') {\n\t\t\t\t\tevent = document.createEvent('Event');\n\t\t\t\t\tevent.initEvent('abort', false, false);\n\t\t\t\t} else {\n\t\t\t\t\tevent = {\n\t\t\t\t\t\ttype: 'abort',\n\t\t\t\t\t\tbubbles: false,\n\t\t\t\t\t\tcancelable: false\n\t\t\t\t\t} as Event;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.signal.dispatchEvent(event);\n\t\t}\n\t};\n}\n\nexport default ShimAbortController;\n"]}