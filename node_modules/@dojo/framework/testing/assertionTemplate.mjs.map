{"version":3,"file":"assertionTemplate.mjs","sourceRoot":"","sources":["assertionTemplate.ts"],"names":[],"mappings":"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","sourcesContent":["import select from './support/selector';\nimport { VNode, WNode, DNode } from '../core/interfaces';\nimport { isWNode, isVNode } from '../core/vdom';\nimport { decorate } from '../core/util';\nimport WidgetBase from '../core/WidgetBase';\n\nexport type PropertiesComparatorFunction = (actualProperties: any) => any;\n\nexport type TemplateChildren = DNode[] | (() => DNode[]);\n\nexport interface AssertionTemplateResult {\n\t(): DNode | DNode[];\n\tappend(selector: string, children: TemplateChildren): AssertionTemplateResult;\n\tprepend(selector: string, children: TemplateChildren): AssertionTemplateResult;\n\treplaceChildren(selector: string, children: TemplateChildren): AssertionTemplateResult;\n\tinsertBefore(selector: string, children: TemplateChildren): AssertionTemplateResult;\n\tinsertAfter(selector: string, children: TemplateChildren): AssertionTemplateResult;\n\tinsertSiblings(selector: string, children: TemplateChildren, type?: 'before' | 'after'): AssertionTemplateResult;\n\tsetChildren(\n\t\tselector: string,\n\t\tchildren: TemplateChildren,\n\t\ttype?: 'prepend' | 'replace' | 'append'\n\t): AssertionTemplateResult;\n\tsetProperty(selector: string, property: string, value: any): AssertionTemplateResult;\n\tsetProperties(selector: string, value: any | PropertiesComparatorFunction): AssertionTemplateResult;\n\tgetChildren(selector: string): DNode[];\n\tgetProperty(selector: string, property: string): any;\n\tgetProperties(selector: string): any;\n\treplace(selector: string, node: DNode): AssertionTemplateResult;\n\tremove(selector: string): AssertionTemplateResult;\n}\n\ntype NodeWithProperties = (VNode | WNode) & { properties: { [index: string]: any } };\n\nconst findOne = (nodes: DNode | DNode[], selector: string): NodeWithProperties => {\n\tlet finalSelector = selector;\n\tif (selector.indexOf('~') === 0) {\n\t\tfinalSelector = `[\\\\~key='${selector.substr(1)}']`;\n\t}\n\tlet [node] = select(finalSelector, nodes);\n\tif (!node) {\n\t\tfinalSelector = `[assertion-key='${selector.substr(1)}']`;\n\t\t[node] = select(finalSelector, nodes);\n\t}\n\tif (!node) {\n\t\tthrow Error(`Node not found for selector \"${selector}\"`);\n\t}\n\tif (!isWNode(node) && !isVNode(node)) {\n\t\tthrow Error('Cannot set or get on unknown node');\n\t}\n\treturn node;\n};\n\nconst replaceChildren = (\n\tselector: string,\n\trender: DNode | DNode[],\n\tmodifyChildrenFn: (index: number, children: DNode[]) => DNode[]\n): DNode | DNode[] => {\n\tconst node = findOne(render, selector);\n\tconst parent: (VNode | WNode) & { children: DNode[] } | undefined = (node as any).parent;\n\tconst siblings = parent ? parent.children : Array.isArray(render) ? render : [render];\n\tconst newChildren = modifyChildrenFn(siblings.indexOf(node), [...siblings]);\n\n\tif (!parent) {\n\t\treturn newChildren;\n\t}\n\n\tparent.children = newChildren;\n\treturn render;\n};\n\nexport class Ignore extends WidgetBase {}\n\nexport function assertionTemplate(renderFunc: () => DNode | DNode[]) {\n\tconst assertionTemplateResult: any = () => {\n\t\tconst render = renderFunc();\n\t\tdecorate(render, (node) => {\n\t\t\tif (isWNode(node) || isVNode(node)) {\n\t\t\t\tdelete (node as NodeWithProperties).properties['~key'];\n\t\t\t\tdelete (node as NodeWithProperties).properties['assertion-key'];\n\t\t\t}\n\t\t});\n\t\treturn render;\n\t};\n\tassertionTemplateResult.setProperty = (selector: string, property: string, value: any) => {\n\t\treturn assertionTemplate(() => {\n\t\t\tconst render = renderFunc();\n\t\t\tconst node = findOne(render, selector);\n\t\t\tnode.properties[property] = value;\n\t\t\treturn render;\n\t\t});\n\t};\n\tassertionTemplateResult.setProperties = (selector: string, value: any | PropertiesComparatorFunction) => {\n\t\treturn assertionTemplate(() => {\n\t\t\tconst render = renderFunc();\n\t\t\tconst node = findOne(render, selector);\n\t\t\tnode.properties = value;\n\t\t\treturn render;\n\t\t});\n\t};\n\tassertionTemplateResult.append = (selector: string, children: TemplateChildren) => {\n\t\treturn assertionTemplateResult.setChildren(selector, children, 'append');\n\t};\n\tassertionTemplateResult.prepend = (selector: string, children: TemplateChildren) => {\n\t\treturn assertionTemplateResult.setChildren(selector, children, 'prepend');\n\t};\n\tassertionTemplateResult.replaceChildren = (selector: string, children: TemplateChildren) => {\n\t\treturn assertionTemplateResult.setChildren(selector, children, 'replace');\n\t};\n\tassertionTemplateResult.setChildren = (\n\t\tselector: string,\n\t\tchildren: TemplateChildren,\n\t\ttype: 'prepend' | 'replace' | 'append' = 'replace'\n\t) => {\n\t\tif (Array.isArray(children)) {\n\t\t\tconsole.warn(\n\t\t\t\t'The array API (`children: DNode[]`) has been deprecated. Working with children should use a factory to avoid issues with mutation.'\n\t\t\t);\n\t\t}\n\t\treturn assertionTemplate(() => {\n\t\t\tconst render = renderFunc();\n\t\t\tconst node = findOne(render, selector);\n\t\t\tnode.children = node.children || [];\n\t\t\tif (typeof children === 'function') {\n\t\t\t\tchildren = children();\n\t\t\t}\n\t\t\tswitch (type) {\n\t\t\t\tcase 'prepend':\n\t\t\t\t\tnode.children = [...children, ...node.children];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'append':\n\t\t\t\t\tnode.children = [...node.children, ...children];\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'replace':\n\t\t\t\t\tnode.children = [...children];\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\treturn render;\n\t\t});\n\t};\n\tassertionTemplateResult.insertBefore = (selector: string, children: TemplateChildren) => {\n\t\treturn assertionTemplateResult.insertSiblings(selector, children, 'before');\n\t};\n\tassertionTemplateResult.insertAfter = (selector: string, children: TemplateChildren) => {\n\t\treturn assertionTemplateResult.insertSiblings(selector, children, 'after');\n\t};\n\tassertionTemplateResult.insertSiblings = (\n\t\tselector: string,\n\t\tchildren: TemplateChildren,\n\t\ttype: 'before' | 'after' = 'after'\n\t) => {\n\t\tif (Array.isArray(children)) {\n\t\t\tconsole.warn(\n\t\t\t\t'The array API (`children: DNode[]`) has been deprecated. Working with children should use a factory to avoid issues with mutation.'\n\t\t\t);\n\t\t}\n\t\treturn assertionTemplate(() => {\n\t\t\tconst render = renderFunc();\n\t\t\tconst insertedChildren = typeof children === 'function' ? (children = children()) : children;\n\t\t\treturn replaceChildren(selector, render, (index, children) => {\n\t\t\t\tif (type === 'after') {\n\t\t\t\t\tchildren.splice(index + 1, 0, ...insertedChildren);\n\t\t\t\t} else {\n\t\t\t\t\tchildren.splice(index, 0, ...insertedChildren);\n\t\t\t\t}\n\t\t\t\treturn children;\n\t\t\t});\n\t\t});\n\t};\n\tassertionTemplateResult.getProperty = (selector: string, property: string) => {\n\t\tconst render = renderFunc();\n\t\tconst node = findOne(render, selector);\n\t\treturn node.properties[property];\n\t};\n\tassertionTemplateResult.getProperties = (selector: string, property: string) => {\n\t\tconst render = renderFunc();\n\t\tconst node = findOne(render, selector);\n\t\treturn node.properties;\n\t};\n\tassertionTemplateResult.getChildren = (selector: string) => {\n\t\tconst render = renderFunc();\n\t\tconst node = findOne(render, selector);\n\t\treturn node.children || [];\n\t};\n\tassertionTemplateResult.replace = (selector: string, newNode: DNode) => {\n\t\treturn assertionTemplate(() => {\n\t\t\tconst render = renderFunc();\n\t\t\treturn replaceChildren(selector, render, (index, children) => {\n\t\t\t\tchildren.splice(index, 1, newNode);\n\t\t\t\treturn children;\n\t\t\t});\n\t\t});\n\t};\n\tassertionTemplateResult.remove = (selector: string) => {\n\t\treturn assertionTemplate(() => {\n\t\t\tconst render = renderFunc();\n\t\t\treturn replaceChildren(selector, render, (index, children) => {\n\t\t\t\tchildren.splice(index, 1);\n\t\t\t\treturn children;\n\t\t\t});\n\t\t});\n\t};\n\treturn assertionTemplateResult as AssertionTemplateResult;\n}\n\nexport default assertionTemplate;\n"]}