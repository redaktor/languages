{"version":3,"file":"selector.js","sourceRoot":"","sources":["selector.ts"],"names":[],"mappings":"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","sourcesContent":["import { DNode, DefaultWidgetBaseInterface, WNode, VNode } from '../../core/interfaces';\nimport * as cssSelect from 'css-select-umd';\nimport { isVNode, isWNode } from '../../core/vdom';\nimport { decorate } from '../../core/util';\n\nexport type TestFunction = (elem: DNode<DefaultWidgetBaseInterface>) => boolean;\n\nexport interface DecoratorResult<T> {\n\thasDeferredProperties: boolean;\n\tnodes: T;\n}\n\nexport function decorateNodes(dNode: DNode[]): DecoratorResult<DNode[]>;\nexport function decorateNodes(dNode: DNode): DecoratorResult<DNode>;\nexport function decorateNodes(dNode: DNode | DNode[]): DecoratorResult<DNode | DNode[]>;\nexport function decorateNodes(dNode: any): DecoratorResult<DNode | DNode[]> {\n\tlet hasDeferredProperties = false;\n\tfunction addParent(parent: WNode | VNode): void {\n\t\t(parent.children || []).forEach((child) => {\n\t\t\tif (isVNode(child) || isWNode(child)) {\n\t\t\t\t(child as any).parent = parent;\n\t\t\t}\n\t\t});\n\t\tif (isVNode(parent) && typeof parent.deferredPropertiesCallback === 'function') {\n\t\t\thasDeferredProperties = true;\n\t\t\tparent.properties = { ...parent.properties, ...parent.deferredPropertiesCallback(false) };\n\t\t}\n\t}\n\tconst nodes = decorate(dNode, addParent, (node: DNode): node is WNode | VNode => isWNode(node) || isVNode(node));\n\treturn { hasDeferredProperties, nodes };\n}\n\nexport const parseSelector = (selector: string) => {\n\tconst selectors = selector.split(' ');\n\treturn selectors\n\t\t.map((selector) => {\n\t\t\tconst keySigilIndex = selector.indexOf('@');\n\t\t\tif (keySigilIndex === 0) {\n\t\t\t\treturn `[key=\"${selector.substr(1)}\"]`;\n\t\t\t} else if (keySigilIndex > 0) {\n\t\t\t\tconst key = selector.substring(keySigilIndex + 1);\n\t\t\t\treturn `${selector.slice(0, keySigilIndex)}[key=\"${key}\"]`;\n\t\t\t}\n\t\t\treturn selector;\n\t\t})\n\t\t.join(' ');\n};\n\nexport const adapter: any = {\n\tisTag(elem: DNode) {\n\t\treturn isVNode(elem);\n\t},\n\tgetText(elem: DNode[]) {\n\t\treturn '';\n\t},\n\tremoveSubsets(elements: DNode[]) {\n\t\treturn elements;\n\t},\n\tgetChildren(elem: DNode) {\n\t\treturn isVNode(elem) || isWNode(elem) ? elem.children : [];\n\t},\n\tgetAttributeValue(elem: DNode, name: string) {\n\t\tif (isVNode(elem) || isWNode(elem)) {\n\t\t\tif (name === 'class') {\n\t\t\t\tconst classes = (elem.properties as any).classes;\n\t\t\t\tif (Array.isArray(classes)) {\n\t\t\t\t\treturn classes.join(' ');\n\t\t\t\t}\n\t\t\t\treturn classes;\n\t\t\t}\n\t\t\treturn (elem.properties as any)[name];\n\t\t}\n\t},\n\thasAttrib(elem: DNode, name: string) {\n\t\tif (isVNode(elem) || isWNode(elem)) {\n\t\t\treturn name in elem.properties;\n\t\t}\n\t\treturn false;\n\t},\n\texistsOne(test: TestFunction, elements: DNode[]) {\n\t\treturn elements.some((elem: DNode) => test(elem));\n\t},\n\tgetName(elem: DNode) {\n\t\tif (isVNode(elem)) {\n\t\t\treturn elem.tag;\n\t\t}\n\t},\n\tgetParent(elem: DNode) {\n\t\tif (isVNode(elem) || isWNode(elem)) {\n\t\t\treturn (elem as any).parent;\n\t\t}\n\t},\n\tgetSiblings(elem: DNode) {\n\t\tif (isVNode(elem) || isWNode(elem)) {\n\t\t\tif ((elem as any).parent) {\n\t\t\t\treturn (elem as any).parent.children;\n\t\t\t}\n\t\t\treturn [elem];\n\t\t}\n\t},\n\tfindOne(test: TestFunction, arr: DNode[]): DNode {\n\t\tlet elem = null;\n\t\tfor (let i = 0, l = arr.length; i < l && !elem; i++) {\n\t\t\tif (test(arr[i])) {\n\t\t\t\telem = arr[i];\n\t\t\t} else {\n\t\t\t\tconst children = adapter.getChildren(arr[i]);\n\t\t\t\tif (children && children.length > 0) {\n\t\t\t\t\telem = adapter.findOne(test, children);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn elem;\n\t},\n\tfindAll(test: TestFunction, elements: DNode[]): DNode[] {\n\t\tlet result: DNode[] = [];\n\t\tfor (let i = 0, j = elements.length; i < j; i++) {\n\t\t\tif (test(elements[i])) {\n\t\t\t\tresult.push(elements[i]);\n\t\t\t}\n\t\t\tconst children = adapter.getChildren(elements[i]);\n\t\t\tif (children) {\n\t\t\t\tresult = [...result, ...adapter.findAll(test, children)];\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n};\n\nexport function select(selector: string, nodes: DNode | DNode[]): (WNode | VNode)[] {\n\tnodes = decorateNodes(nodes).nodes;\n\tnodes = Array.isArray(nodes) ? nodes : [nodes];\n\tselector = parseSelector(selector);\n\treturn cssSelect(selector, nodes, { adapter }) as (WNode | VNode)[];\n}\n\nexport default select;\n"]}